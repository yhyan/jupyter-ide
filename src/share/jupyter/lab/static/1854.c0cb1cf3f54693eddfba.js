(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[1854],{81854:(t,e,s)=>{"use strict";s.r(e);s.d(e,{OutputArea:()=>M,OutputAreaModel:()=>d,OutputPrompt:()=>N,SimplifiedOutputArea:()=>S,Stdin:()=>k});var n=s(28059);var i=s(20702);var r=s(72805);var a=s(62867);var o=s(9727);var u=s(75138);class d{constructor(t={}){this.clearNext=false;this._trusted=false;this._isDisposed=false;this._stateChanged=new u.Signal(this);this._changed=new u.Signal(this);this._trusted=!!t.trusted;this.contentFactory=t.contentFactory||d.defaultContentFactory;this.list=new i.ObservableList;if(t.values){(0,a.each)(t.values,(t=>{this._add(t)}))}this.list.changed.connect(this._onListChanged,this)}get stateChanged(){return this._stateChanged}get changed(){return this._changed}get length(){return this.list?this.list.length:0}get trusted(){return this._trusted}set trusted(t){if(t===this._trusted){return}const e=this._trusted=t;for(let s=0;s<this.list.length;s++){let t=this.list.get(s);const n=t.toJSON();t.dispose();t=this._createItem({value:n,trusted:e});this.list.set(s,t)}}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;this.list.dispose();u.Signal.clearData(this)}get(t){return this.list.get(t)}set(t,e){e=o.JSONExt.deepCopy(e);h.normalize(e);const s=this._createItem({value:e,trusted:this._trusted});this.list.set(t,s)}add(t){if(this.clearNext){this.clear();this.clearNext=false}return this._add(t)}clear(t=false){this._lastStream="";if(t){this.clearNext=true;return}(0,a.each)(this.list,(t=>{t.dispose()}));this.list.clear()}fromJSON(t){this.clear();(0,a.each)(t,(t=>{this._add(t)}))}toJSON(){return(0,a.toArray)((0,a.map)(this.list,(t=>t.toJSON())))}_add(t){const e=this._trusted;t=o.JSONExt.deepCopy(t);h.normalize(t);if(n.isStream(t)&&this._lastStream&&t.name===this._lastName&&this.shouldCombine({value:t,lastModel:this.list.get(this.length-1)})){this._lastStream+=t.text;this._lastStream=h.removeOverwrittenChars(this._lastStream);t.text=this._lastStream;const s=this._createItem({value:t,trusted:e});const n=this.length-1;const i=this.list.get(n);i.dispose();this.list.set(n,s);return n}if(n.isStream(t)){t.text=h.removeOverwrittenChars(t.text)}const s=this._createItem({value:t,trusted:e});if(n.isStream(t)){this._lastStream=t.text;this._lastName=t.name}else{this._lastStream=""}return this.list.push(s)}shouldCombine(t){return true}_createItem(t){const e=this.contentFactory;const s=e.createOutputModel(t);s.changed.connect(this._onGenericChange,this);return s}_onListChanged(t,e){this._changed.emit(e)}_onGenericChange(){this._stateChanged.emit(void 0)}}(function(t){class e{createOutputModel(t){return new r.OutputModel(t)}}t.ContentFactory=e;t.defaultContentFactory=new e})(d||(d={}));var h;(function(t){function e(t){if(n.isStream(t)){if(Array.isArray(t.text)){t.text=t.text.join("\n")}}}t.normalize=e;function s(t){let e=t;do{t=e;e=t.replace(/[^\n]\x08/gm,"")}while(e.length<t.length);return t}function i(t){t=t.replace(/\r+\n/gm,"\n");while(t.search(/\r[^$]/g)>-1){const e=t.match(/^(.*)\r+/m)[1];let s=t.match(/\r+(.*)$/m)[1];s=s+e.slice(s.length,e.length);t=t.replace(/\r+.*$/m,"\r").replace(/^.*\r/m,s)}return t}function r(t){return i(s(t))}t.removeOverwrittenChars=r})(h||(h={}));var l=s(26825);var c=s(50317);var p=s(72189);var m=s(61389);var g=s(97209);const _="jp-OutputArea";const f="jp-OutputArea-child";const y="jp-OutputArea-output";const O="jp-OutputArea-prompt";const x="jp-OutputPrompt";const C="jp-OutputArea-executeResult";const w="jp-OutputArea-stdin-item";const v="jp-Stdin";const I="jp-Stdin-prompt";const b="jp-Stdin-input";class M extends m.Widget{constructor(t){super();this.outputLengthChanged=new u.Signal(this);this._onIOPub=t=>{const e=this.model;const s=t.header.msg_type;let n;const i=t.content.transient||{};const r=i["display_id"];let a;switch(s){case"execute_result":case"display_data":case"stream":case"error":n=Object.assign(Object.assign({},t.content),{output_type:s});e.add(n);break;case"clear_output":{const s=t.content.wait;e.clear(s);break}case"update_display_data":n=Object.assign(Object.assign({},t.content),{output_type:"display_data"});a=this._displayIdMap.get(r);if(a){for(const t of a){e.set(t,n)}}break;default:break}if(r&&s==="display_data"){a=this._displayIdMap.get(r)||[];a.push(e.length-1);this._displayIdMap.set(r,a)}};this._onExecuteReply=t=>{const e=this.model;const s=t.content;if(s.status!=="ok"){return}const n=s&&s.payload;if(!n||!n.length){return}const i=n.filter((t=>t.source==="page"));if(!i.length){return}const r=JSON.parse(JSON.stringify(i[0]));const a={output_type:"display_data",data:r.data,metadata:{}};e.add(a)};this._minHeightTimeout=null;this._displayIdMap=new Map;this._outputTracker=new l.WidgetTracker({namespace:o.UUID.uuid4()});const e=this.model=t.model;this.addClass(_);this.rendermime=t.rendermime;this.contentFactory=t.contentFactory||M.defaultContentFactory;this.layout=new m.PanelLayout;this.trimmedOutputModels=new Array;this.maxNumberOutputs=t.maxNumberOutputs||0;this.headEndIndex=this.maxNumberOutputs;for(let s=0;s<e.length;s++){const t=e.get(s);this._insertOutput(s,t)}e.changed.connect(this.onModelChanged,this);e.stateChanged.connect(this.onStateChanged,this)}get widgets(){return this.layout.widgets}get future(){return this._future}set future(t){if(this.model.isDisposed){throw Error("Model is disposed")}if(this._future===t){return}if(this._future){this._future.dispose()}this._future=t;this.model.clear();if(this.widgets.length){this._clear();this.outputLengthChanged.emit(this.model.length)}t.onIOPub=this._onIOPub;t.onReply=this._onExecuteReply;t.onStdin=e=>{if(c.KernelMessage.isInputRequestMsg(e)){this.onInputRequest(e,t)}}}dispose(){if(this._future){this._future.dispose();this._future=null}this._displayIdMap.clear();this._outputTracker.dispose();super.dispose()}onModelChanged(t,e){switch(e.type){case"add":this._insertOutput(e.newIndex,e.newValues[0]);this.outputLengthChanged.emit(this.model.length);break;case"remove":if(this.widgets.length){if(this.model.length===0){this._clear()}else{const t=e.oldIndex;for(let s=0;s<e.oldValues.length&&t<this.widgets.length;++s){const e=this.widgets[t];e.parent=null;e.dispose()}this._moveDisplayIdIndices(t,e.oldValues.length);this._preventHeightChangeJitter()}this.outputLengthChanged.emit(this.model.length)}break;case"set":this._setOutput(e.newIndex,e.newValues[0]);this.outputLengthChanged.emit(this.model.length);break;default:break}}_moveDisplayIdIndices(t,e){this._displayIdMap.forEach((s=>{const n=t+e;const i=s.length;for(let r=i-1;r>=0;--r){const i=s[r];if(i>=t&&i<n){s.splice(r,1)}else if(i>=n){s[r]-=e}}}))}onStateChanged(t){this.trimmedOutputModels=new Array;for(let e=0;e<this.model.length;e++){this._setOutput(e,this.model.get(e))}this.outputLengthChanged.emit(this.model.length)}_clear(){if(!this.widgets.length){return}const t=this.widgets.length;for(let e=0;e<t;e++){const t=this.widgets[0];t.parent=null;t.dispose()}this._displayIdMap.clear();this._preventHeightChangeJitter()}_preventHeightChangeJitter(){const t=this.node.getBoundingClientRect();this.node.style.minHeight=`${t.height}px`;if(this._minHeightTimeout){window.clearTimeout(this._minHeightTimeout)}this._minHeightTimeout=window.setTimeout((()=>{if(this.isDisposed){return}this.node.style.minHeight=""}),50)}onInputRequest(t,e){const s=this.contentFactory;const n=t.content.prompt;const i=t.content.password;const r=new m.Panel;r.addClass(f);r.addClass(w);const a=s.createOutputPrompt();a.addClass(O);r.addWidget(a);const o=s.createStdin({prompt:n,password:i,future:e});o.addClass(y);r.addWidget(o);const u=this.layout;u.addWidget(r);void o.value.then((t=>{this.model.add({output_type:"stream",name:"stdin",text:t+"\n"});r.dispose()}))}_setOutput(t,e){if(t>=this.headEndIndex&&this.maxNumberOutputs!==0){this.trimmedOutputModels[t-this.headEndIndex]=e;return}const s=this.layout;const n=s.widgets[t];const i=n.widgets?n.widgets[1]:n;const r=this.rendermime.preferredMimeType(e.data,e.trusted?"any":"ensure");if(i.renderModel&&A.currentPreferredMimetype.get(i)===r&&M.isIsolated(r,e.metadata)===i instanceof A.IsolatedRenderer){void i.renderModel(e)}else{s.widgets[t].dispose();this._insertOutput(t,e)}}_insertOutput(t,e){if(t===0){this.trimmedOutputModels=new Array}if(t===this.maxNumberOutputs&&this.maxNumberOutputs!==0){const t=this.model.contentFactory.createOutputModel({value:{output_type:"display_data",data:{"text/html":`\n              <a style="margin: 10px; text-decoration: none; cursor: pointer;">\n                <pre>Output of this cell has been trimmed on the initial display.</pre>\n                <pre>Displaying the first ${this.maxNumberOutputs} top outputs.</pre>\n                <pre>Click on this message to get the complete output.</pre>\n              </a>\n              `}}});const e=()=>this._showTrimmedOutputs();const s=this.createOutputItem(t);s.node.addEventListener("click",e);const n=this.layout;n.insertWidget(this.headEndIndex,s)}const s=this._createOutput(e);const n=this.layout;if(t<this.maxNumberOutputs||this.maxNumberOutputs===0){n.insertWidget(t,s)}if(t>=this.maxNumberOutputs&&this.maxNumberOutputs!==0){this.trimmedOutputModels.push(e)}if(!this._outputTracker.has(s)){void this._outputTracker.add(s)}}_createOutput(t){let e=this.createOutputItem(t);if(e){e.toggleClass(C,t.executionCount!==null)}else{e=new m.Widget}return e}get outputTracker(){return this._outputTracker}_showTrimmedOutputs(){const t=this.layout;t.removeWidgetAt(this.headEndIndex);for(let e=0;e<this.trimmedOutputModels.length;e++){const s=this._createOutput(this.trimmedOutputModels[e]);t.insertWidget(this.headEndIndex+e,s)}}createOutputItem(t){const e=this.createRenderedMimetype(t);if(!e){return null}const s=new A.OutputPanel;s.addClass(f);const n=this.contentFactory.createOutputPrompt();n.executionCount=t.executionCount;n.addClass(O);s.addWidget(n);e.addClass(y);s.addWidget(e);return s}createRenderedMimetype(t){const e=this.rendermime.preferredMimeType(t.data,t.trusted?"any":"ensure");if(!e){return null}let s=this.rendermime.createRenderer(e);const n=M.isIsolated(e,t.metadata);if(n===true){s=new A.IsolatedRenderer(s)}A.currentPreferredMimetype.set(s,e);s.renderModel(t).catch((t=>{const e=document.createElement("pre");e.textContent=`Javascript Error: ${t.message}`;s.node.appendChild(e);s.node.className="lm-Widget jp-RenderedText";s.node.setAttribute("data-mime-type","application/vnd.jupyter.stderr")}));return s}}class S extends M{onInputRequest(t,e){return}createOutputItem(t){const e=this.createRenderedMimetype(t);if(e){e.addClass(y)}return e}}(function(t){async function e(t,e,s,n){var i;let r=true;if(n&&Array.isArray(n.tags)&&n.tags.indexOf("raises-exception")!==-1){r=false}const a={code:t,stop_on_error:r};const o=(i=s.session)===null||i===void 0?void 0:i.kernel;if(!o){throw new Error("Session has no kernel.")}const u=o.requestExecute(a,false,n);e.future=u;return u.done}t.execute=e;function s(t,e){const s=e[t];if(s&&s["isolated"]!==undefined){return!!s["isolated"]}else{return!!e["isolated"]}}t.isIsolated=s;class n{createOutputPrompt(){return new N}createStdin(t){return new k(t)}}t.ContentFactory=n;t.defaultContentFactory=new n})(M||(M={}));class N extends m.Widget{constructor(){super();this._executionCount=null;this.addClass(x)}get executionCount(){return this._executionCount}set executionCount(t){this._executionCount=t;if(t===null){this.node.textContent=""}else{this.node.textContent=`[${t}]:`}}}class k extends m.Widget{constructor(t){super({node:A.createInputWidgetNode(t.prompt,t.password)});this._promise=new o.PromiseDelegate;this.addClass(v);this._input=this.node.getElementsByTagName("input")[0];this._input.focus();this._future=t.future;this._value=t.prompt+" "}get value(){return this._promise.promise.then((()=>this._value))}handleEvent(t){const e=this._input;if(t.type==="keydown"){if(t.keyCode===13){this._future.sendInputReply({status:"ok",value:e.value});if(e.type==="password"){this._value+=Array(e.value.length+1).join("Â·")}else{this._value+=e.value}this._promise.resolve(void 0)}}}onAfterAttach(t){this._input.addEventListener("keydown",this);this.update()}onUpdateRequest(t){this._input.focus()}onBeforeDetach(t){this._input.removeEventListener("keydown",this)}}var A;(function(t){function e(t,e){const s=document.createElement("div");const n=document.createElement("pre");n.className=I;n.textContent=t;const i=document.createElement("input");i.className=b;if(e){i.type="password"}s.appendChild(n);n.appendChild(i);return s}t.createInputWidgetNode=e;class s extends m.Widget{constructor(t){super({node:document.createElement("iframe")});this.addClass("jp-mod-isolated");this._wrapped=t;const e=this.node;e.frameBorder="0";e.scrolling="auto";e.addEventListener("load",(()=>{e.contentDocument.open();e.contentDocument.write(this._wrapped.node.innerHTML);e.contentDocument.close();const t=e.contentDocument.body;e.style.height=`${t.scrollHeight}px`;e.heightChangeObserver=new g.Z((()=>{e.style.height=`${t.scrollHeight}px`}));e.heightChangeObserver.observe(t)}))}renderModel(t){return this._wrapped.renderModel(t)}}t.IsolatedRenderer=s;t.currentPreferredMimetype=new p.AttachedProperty({name:"preferredMimetype",create:t=>""});class n extends m.Panel{constructor(t){super(t)}_onContext(t){this.node.focus()}onAfterAttach(t){super.onAfterAttach(t);this.node.addEventListener("contextmenu",this._onContext.bind(this))}onBeforeDetach(t){super.onAfterDetach(t);this.node.removeEventListener("contextmenu",this._onContext.bind(this))}}t.OutputPanel=n})(A||(A={}))}}]);