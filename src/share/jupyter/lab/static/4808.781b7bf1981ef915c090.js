(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[4808],{14808:(e,t,i)=>{"use strict";i.r(t);i.d(t,{CodeEditor:()=>a,CodeEditorWrapper:()=>S,IEditorMimeTypeService:()=>N,IEditorServices:()=>B,JSONEditor:()=>g});var s=i(20702);var o=i(56806);var r=i(75138);const n=o.createMutex();var a;(function(e){e.defaultSelectionStyle={className:"",displayName:"",color:"black"};class t{constructor(e){this._isDisposed=false;this._mimeTypeChanged=new r.Signal(this);this._sharedModelSwitched=new r.Signal(this);e=e||{};if(e.modelDB){this.modelDB=e.modelDB}else{this.modelDB=new s.ModelDB}this.sharedModel=o.createStandaloneCell(this.type,e.id);this.sharedModel.changed.connect(this._onSharedModelChanged,this);const t=this.modelDB.createString("value");t.changed.connect(this._onModelDBValueChanged,this);t.text=t.text||e.value||"";const i=this.modelDB.createValue("mimeType");i.changed.connect(this._onModelDBMimeTypeChanged,this);i.set(e.mimeType||"text/plain");this.modelDB.createMap("selections")}switchSharedModel(e,t){if(t){this.value.text=e.getSource()}this.sharedModel.changed.disconnect(this._onSharedModelChanged,this);this.sharedModel=e;this.sharedModel.changed.connect(this._onSharedModelChanged,this);this._sharedModelSwitched.emit(true)}_onSharedModelChanged(e,t){n((()=>{if(t.sourceChange){const e=this.modelDB.get("value");let i=0;t.sourceChange.forEach((t=>{if(t.insert!=null){e.insert(i,t.insert);i+=t.insert.length}else if(t.delete!=null){e.remove(i,i+t.delete)}else if(t.retain!=null){i+=t.retain}}))}}))}_onModelDBValueChanged(e,t){n((()=>{this.sharedModel.transact((()=>{switch(t.type){case"insert":this.sharedModel.updateSource(t.start,t.start,t.value);break;case"remove":this.sharedModel.updateSource(t.start,t.end);break;default:this.sharedModel.setSource(e.text);break}}))}))}get type(){return"code"}get mimeTypeChanged(){return this._mimeTypeChanged}get sharedModelSwitched(){return this._sharedModelSwitched}get value(){return this.modelDB.get("value")}get selections(){return this.modelDB.get("selections")}get mimeType(){return this.modelDB.getValue("mimeType")}set mimeType(e){const t=this.mimeType;if(t===e){return}this.modelDB.setValue("mimeType",e)}get isDisposed(){return this._isDisposed}dispose(){if(this._isDisposed){return}this._isDisposed=true;r.Signal.clearData(this)}_onModelDBMimeTypeChanged(e,t){this._mimeTypeChanged.emit({name:"mimeType",oldValue:t.oldValue,newValue:t.newValue})}}e.Model=t;e.defaultConfig={cursorBlinkRate:530,fontFamily:null,fontSize:null,lineHeight:null,lineNumbers:false,lineWrap:"on",wordWrapColumn:80,readOnly:false,tabSize:4,insertSpaces:true,matchBrackets:true,autoClosingBrackets:false,handlePaste:true,rulers:[],codeFolding:false,showTrailingSpace:false}})(a||(a={}));var d=i(1612);var h=i(92481);var l=i(9727);var c=i(61389);const u="jp-JSONEditor";const m="jp-mod-error";const p="jp-JSONEditor-host";const f="jp-JSONEditor-header";class g extends c.Widget{constructor(e){super();this._dataDirty=false;this._inputDirty=false;this._source=null;this._originalValue=l.JSONExt.emptyObject;this._changeGuard=false;this.translator=e.translator||d.nullTranslator;this._trans=this.translator.load("jupyterlab");this.addClass(u);this.headerNode=document.createElement("div");this.headerNode.className=f;this.revertButtonNode=h.undoIcon.element({tag:"span",title:this._trans.__("Revert changes to data")});this.commitButtonNode=h.checkIcon.element({tag:"span",title:this._trans.__("Commit changes to data"),marginLeft:"8px"});this.editorHostNode=document.createElement("div");this.editorHostNode.className=p;this.headerNode.appendChild(this.revertButtonNode);this.headerNode.appendChild(this.commitButtonNode);this.node.appendChild(this.headerNode);this.node.appendChild(this.editorHostNode);const t=new a.Model;t.value.text=this._trans.__("No data!");t.mimeType="application/json";t.value.changed.connect(this._onValueChanged,this);this.model=t;this.editor=e.editorFactory({host:this.editorHostNode,model:t});this.editor.setOption("readOnly",true)}get source(){return this._source}set source(e){if(this._source===e){return}if(this._source){this._source.changed.disconnect(this._onSourceChanged,this)}this._source=e;this.editor.setOption("readOnly",e===null);if(e){e.changed.connect(this._onSourceChanged,this)}this._setValue()}get isDirty(){return this._dataDirty||this._inputDirty}handleEvent(e){switch(e.type){case"blur":this._evtBlur(e);break;case"click":this._evtClick(e);break;default:break}}onAfterAttach(e){const t=this.editorHostNode;t.addEventListener("blur",this,true);t.addEventListener("click",this,true);this.revertButtonNode.hidden=true;this.commitButtonNode.hidden=true;this.headerNode.addEventListener("click",this);if(this.isVisible){this.update()}}onAfterShow(e){this.update()}onUpdateRequest(e){this.editor.refresh()}onBeforeDetach(e){const t=this.editorHostNode;t.removeEventListener("blur",this,true);t.removeEventListener("click",this,true);this.headerNode.removeEventListener("click",this)}_onSourceChanged(e,t){if(this._changeGuard){return}if(this._inputDirty||this.editor.hasFocus()){this._dataDirty=true;return}this._setValue()}_onValueChanged(){let e=true;try{const e=JSON.parse(this.editor.model.value.text);this.removeClass(m);this._inputDirty=!this._changeGuard&&!l.JSONExt.deepEqual(e,this._originalValue)}catch(t){this.addClass(m);this._inputDirty=true;e=false}this.revertButtonNode.hidden=!this._inputDirty;this.commitButtonNode.hidden=!e||!this._inputDirty}_evtBlur(e){if(!this._inputDirty&&this._dataDirty){this._setValue()}}_evtClick(e){const t=e.target;if(this.revertButtonNode.contains(t)){this._setValue()}else if(this.commitButtonNode.contains(t)){if(!this.commitButtonNode.hidden&&!this.hasClass(m)){this._changeGuard=true;this._mergeContent();this._changeGuard=false;this._setValue()}}else if(this.editorHostNode.contains(t)){this.editor.focus()}}_mergeContent(){const e=this.editor.model;const t=this._originalValue;const i=JSON.parse(e.value.text);const s=this.source;if(!s){return}for(const o in i){if(!l.JSONExt.deepEqual(i[o],t[o]||null)){s.set(o,i[o])}}for(const o in t){if(!(o in i)){s.delete(o)}}}_setValue(){this._dataDirty=false;this._inputDirty=false;this.revertButtonNode.hidden=true;this.commitButtonNode.hidden=true;this.removeClass(m);const e=this.editor.model;const t=this._source?this._source.toJSON():{};this._changeGuard=true;if(t===void 0){e.value.text=this._trans.__("No data!");this._originalValue=l.JSONExt.emptyObject}else{const i=JSON.stringify(t,null,4);e.value.text=i;this._originalValue=t;if(i.length>1&&i[0]==="{"){this.editor.setCursorPosition({line:0,column:1})}}this.editor.refresh();this._changeGuard=false;this.commitButtonNode.hidden=true;this.revertButtonNode.hidden=true}}const _="jp-mod-has-primary-selection";const v="jp-mod-in-leading-whitespace";const y="jp-mod-dropTarget";const D=/^\s+$/;class S extends c.Widget{constructor(e){super();this._hasRefreshedSinceAttach=false;const t=this.editor=e.factory({host:this.node,model:e.model,uuid:e.uuid,config:e.config,selectionStyle:e.selectionStyle});t.model.selections.changed.connect(this._onSelectionsChanged,this);this._updateOnShow=e.updateOnShow!==false}get model(){return this.editor.model}dispose(){if(this.isDisposed){return}super.dispose();this.editor.dispose()}handleEvent(e){switch(e.type){case"lm-dragenter":this._evtDragEnter(e);break;case"lm-dragleave":this._evtDragLeave(e);break;case"lm-dragover":this._evtDragOver(e);break;case"lm-drop":this._evtDrop(e);break;default:break}}onActivateRequest(e){this.editor.focus()}onAfterAttach(e){super.onAfterAttach(e);const t=this.node;t.addEventListener("lm-dragenter",this);t.addEventListener("lm-dragleave",this);t.addEventListener("lm-dragover",this);t.addEventListener("lm-drop",this);this._hasRefreshedSinceAttach=false;if(this.isVisible){this.update()}}onBeforeDetach(e){const t=this.node;t.removeEventListener("lm-dragenter",this);t.removeEventListener("lm-dragleave",this);t.removeEventListener("lm-dragover",this);t.removeEventListener("lm-drop",this)}onAfterShow(e){if(this._updateOnShow||!this._hasRefreshedSinceAttach){this.update()}}onResize(e){if(e.width>=0&&e.height>=0){this.editor.setSize(e)}else if(this.isVisible){this.editor.resizeToFit()}}onUpdateRequest(e){if(this.isVisible){this._hasRefreshedSinceAttach=true;this.editor.refresh()}}_onSelectionsChanged(){const{start:e,end:t}=this.editor.getSelection();if(e.column!==t.column||e.line!==t.line){this.addClass(_);this.removeClass(v)}else{this.removeClass(_);if(this.editor.getLine(t.line).slice(0,t.column).match(D)){this.addClass(v)}else{this.removeClass(v)}}}_evtDragEnter(e){if(this.editor.getOption("readOnly")===true){return}const t=C.findTextData(e.mimeData);if(t===undefined){return}e.preventDefault();e.stopPropagation();this.addClass("jp-mod-dropTarget")}_evtDragLeave(e){this.removeClass(y);if(this.editor.getOption("readOnly")===true){return}const t=C.findTextData(e.mimeData);if(t===undefined){return}e.preventDefault();e.stopPropagation()}_evtDragOver(e){this.removeClass(y);if(this.editor.getOption("readOnly")===true){return}const t=C.findTextData(e.mimeData);if(t===undefined){return}e.preventDefault();e.stopPropagation();e.dropAction="copy";this.addClass(y)}_evtDrop(e){if(this.editor.getOption("readOnly")===true){return}const t=C.findTextData(e.mimeData);if(t===undefined){return}const i={top:e.y,bottom:e.y,left:e.x,right:e.x,x:e.x,y:e.y,width:0,height:0};const s=this.editor.getPositionForCoordinate(i);if(s===null){return}this.removeClass(y);e.preventDefault();e.stopPropagation();if(e.proposedAction==="none"){e.dropAction="none";return}const o=this.editor.getOffsetAt(s);this.model.value.insert(o,t)}}var C;(function(e){function t(e){const t=e.types();const i=t.find((e=>e.indexOf("text")===0));if(i===undefined){return undefined}return e.getData(i)}e.findTextData=t})(C||(C={}));var N;(function(e){e.defaultMimeType="text/plain"})(N||(N={}));const B=new l.Token("@jupyterlab/codeeditor:IEditorServices")}}]);