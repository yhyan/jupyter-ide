(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[1244],{41244:(e,t,i)=>{"use strict";i.r(t);i.d(t,{ABCWidgetFactory:()=>v,Base64ModelFactory:()=>F,Context:()=>_,DocumentModel:()=>f,DocumentRegistry:()=>M,DocumentWidget:()=>x,MimeContent:()=>C,MimeDocument:()=>T,MimeDocumentFactory:()=>D,TextModelFactory:()=>y});var s=i(26825);var n=i(83875);var a=i(59917);var r=i(72805);var o=i(1612);var h=i(9727);var l=i(76487);var d=i(75138);var c=i(61389);class _{constructor(e){this._path="";this._lineEnding=null;this._contentsModel=null;this._populatedPromise=new h.PromiseDelegate;this._isPopulated=false;this._isReady=false;this._isDisposed=false;this._pathChanged=new d.Signal(this);this._fileChanged=new d.Signal(this);this._saveState=new d.Signal(this);this._disposed=new d.Signal(this);this._lastModifiedCheckMargin=500;const t=this._manager=e.manager;this.translator=e.translator||o.nullTranslator;this._trans=this.translator.load("jupyterlab");this._factory=e.factory;this._dialogs=e.sessionDialogs||s.sessionContextDialogs;this._opener=e.opener||p.noOp;this._path=this._manager.contents.normalize(e.path);this._lastModifiedCheckMargin=e.lastModifiedCheckMargin||500;const i=this._manager.contents.localPath(this._path);const l=this._factory.preferredLanguage(n.PathExt.basename(i));const c=e.modelDBFactory;if(c){const e=t.contents.localPath(this._path);this._modelDB=c.createNew(e);this._model=this._factory.createNew(l,this._modelDB,false)}else{this._model=this._factory.createNew(l,undefined,false)}const _=this._model.sharedModel;const u=_.ydoc;this._ydoc=u;this._ycontext=u.getMap("context");const m=e.docProviderFactory;this._provider=m?m({path:this._path,contentType:this._factory.contentType,ymodel:_}):new a.ProviderMock;this._readyPromise=t.ready.then((()=>this._populatedPromise.promise));const g=n.PathExt.extname(this._path);this.sessionContext=new s.SessionContext({sessionManager:t.sessions,specsManager:t.kernelspecs,path:this._path,type:g===".ipynb"?"notebook":"file",name:n.PathExt.basename(i),kernelPreference:e.kernelPreference||{shouldStart:false},setBusy:e.setBusy});this.sessionContext.propertyChanged.connect(this._onSessionChanged,this);t.contents.fileChanged.connect(this._onFileChanged,this);const f=this.urlResolver=new r.RenderMimeRegistry.UrlResolver({path:this._path,contents:t.contents});this._ycontext.set("path",this._path);this._ycontext.observe((e=>{var t;const i=e.changes.keys.get("path");if(i){const e=this._ycontext.get("path");if(e&&e!==i.oldValue){f.path=e;this._path=e;this._provider.setPath(e);this._pathChanged.emit(this.path);(t=this.sessionContext.session)===null||t===void 0?void 0:t.setPath(e)}}}))}get pathChanged(){return this._pathChanged}get fileChanged(){return this._fileChanged}get saveState(){return this._saveState}get disposed(){return this._disposed}get lastModifiedCheckMargin(){return this._lastModifiedCheckMargin}set lastModifiedCheckMargin(e){this._lastModifiedCheckMargin=e}get model(){return this._model}get path(){return this._path}get localPath(){return this._manager.contents.localPath(this._path)}get contentsModel(){return this._contentsModel}get factoryName(){return this.isDisposed?"":this._factory.name}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;this.sessionContext.dispose();if(this._modelDB){this._modelDB.dispose()}this._model.dispose();this._provider.destroy();this._model.sharedModel.dispose();this._ydoc.destroy();this._disposed.emit(void 0);d.Signal.clearData(this)}get isReady(){return this._isReady}get ready(){return this._readyPromise}async initialize(e){const t=await this._provider.acquireLock();const i=await this._provider.requestInitialContent();let s;if(e||i){s=this._save()}else{s=this._revert()}const n=()=>{this._provider.releaseLock(t)};s.then((()=>{this._provider.putInitializedState();this._model.initialize()})).then(n,n);return s}rename(e){return this.ready.then((()=>this._manager.ready.then((()=>this._rename(e)))))}async save(){const[e]=await Promise.all([this._provider.acquireLock(),this.ready]);let t;t=this._save();t=t.then((()=>{this._provider.putInitializedState()}));const i=()=>{this._provider.releaseLock(e)};t.then(i,i);return await t}saveAs(){return this.ready.then((()=>p.getSavePath(this._path))).then((e=>{if(this.isDisposed||!e){return}if(e===this._path){return this.save()}return this._manager.ready.then((()=>this._manager.contents.get(e))).then((()=>this._maybeOverWrite(e))).catch((t=>{if(!t.response||t.response.status!==404){throw t}return this._finishSaveAs(e)}))}))}async download(){const e=await this._manager.contents.getDownloadUrl(this._path);const t=document.createElement("a");t.href=e;t.download="";document.body.appendChild(t);t.click();document.body.removeChild(t);return void 0}async revert(){const[e]=await Promise.all([this._provider.acquireLock(),this.ready]);const t=this._revert();const i=()=>{this._provider.releaseLock(e)};t.then(i,i);return await t}createCheckpoint(){const e=this._manager.contents;return this._manager.ready.then((()=>e.createCheckpoint(this._path)))}deleteCheckpoint(e){const t=this._manager.contents;return this._manager.ready.then((()=>t.deleteCheckpoint(this._path,e)))}restoreCheckpoint(e){const t=this._manager.contents;const i=this._path;return this._manager.ready.then((()=>{if(e){return t.restoreCheckpoint(i,e)}return this.listCheckpoints().then((s=>{if(this.isDisposed||!s.length){return}e=s[s.length-1].id;return t.restoreCheckpoint(i,e)}))}))}listCheckpoints(){const e=this._manager.contents;return this._manager.ready.then((()=>e.listCheckpoints(this._path)))}addSibling(e,t={}){const i=this._opener;if(i){i(e,t)}return new l.DisposableDelegate((()=>{e.close()}))}_onFileChanged(e,t){var i,s,a;if(t.type!=="rename"){return}let r=t.oldValue&&t.oldValue.path;let o=t.newValue&&t.newValue.path;if(o&&this._path.indexOf(r||"")===0){let e=t.newValue;if(r!==this._path){o=this._path.replace(new RegExp(`^${r}/`),`${o}/`);r=this._path;e={last_modified:(i=t.newValue)===null||i===void 0?void 0:i.created,path:o}}this._path=o;void((s=this.sessionContext.session)===null||s===void 0?void 0:s.setPath(o));const h=Object.assign(Object.assign({},this._contentsModel),e);const l=this._manager.contents.localPath(o);void((a=this.sessionContext.session)===null||a===void 0?void 0:a.setName(n.PathExt.basename(l)));this._updateContentsModel(h);this._ycontext.set("path",this._path)}}_onSessionChanged(e,t){if(t!=="path"){return}const i=this.sessionContext.session.path;if(i!==this._path){this._path=i;this._ycontext.set("path",this._path)}}_updateContentsModel(e){const t={path:e.path,name:e.name,type:e.type,content:undefined,writable:e.writable,created:e.created,last_modified:e.last_modified,mimetype:e.mimetype,format:e.format};const i=this._contentsModel?this._contentsModel.last_modified:null;this._contentsModel=t;this._ycontext.set("last_modified",t.last_modified);if(!i||t.last_modified!==i){this._fileChanged.emit(t)}}_populate(){this._isPopulated=true;this._isReady=true;this._populatedPromise.resolve(void 0);return this._maybeCheckpoint(false).then((()=>{if(this.isDisposed){return}const e=this._model.defaultKernelName||this.sessionContext.kernelPreference.name;this.sessionContext.kernelPreference=Object.assign(Object.assign({},this.sessionContext.kernelPreference),{name:e,language:this._model.defaultKernelLanguage});void this.sessionContext.initialize().then((e=>{if(e){void this._dialogs.selectKernel(this.sessionContext)}}))}))}async _rename(e){var t,i;const s=this.path.split("/");s[s.length-1]=e;const n=s.join("/");await this._manager.contents.rename(this.path,n);await((t=this.sessionContext.session)===null||t===void 0?void 0:t.setPath(n));await((i=this.sessionContext.session)===null||i===void 0?void 0:i.setName(e));this._path=n;this._ycontext.set("path",this._path)}async _save(){this._saveState.emit("started");const e=this._model;let t;if(this._factory.fileFormat==="json"){t=e.toJSON()}else{t=e.toString();if(this._lineEnding){t=t.replace(/\n/g,this._lineEnding)}}const i={type:this._factory.contentType,format:this._factory.fileFormat,content:t};try{let t;await this._manager.ready;if(!e.modelDB.isCollaborative){t=await this._maybeSave(i)}else{t=await this._manager.contents.save(this._path,i)}if(this.isDisposed){return}e.dirty=false;this._updateContentsModel(t);if(!this._isPopulated){await this._populate()}this._saveState.emit("completed")}catch(s){if(s.message==="Cancel"){throw s}const e=this._manager.contents.localPath(this._path);const t=n.PathExt.basename(e);void this._handleError(s,this._trans.__("File Save Error for %1",t));this._saveState.emit("failed");throw s}}_revert(e=false){const t=Object.assign({type:this._factory.contentType,content:this._factory.fileFormat!==null},this._factory.fileFormat!==null?{format:this._factory.fileFormat}:{});const i=this._path;const s=this._model;return this._manager.ready.then((()=>this._manager.contents.get(i,t))).then((t=>{if(this.isDisposed){return}if(t.format==="json"){s.fromJSON(t.content);if(e){s.initialize()}}else{let i=t.content;if(i.indexOf("\r\n")!==-1){this._lineEnding="\r\n";i=i.replace(/\r\n/g,"\n")}else if(i.indexOf("\r")!==-1){this._lineEnding="\r";i=i.replace(/\r/g,"\n")}else{this._lineEnding=null}s.fromString(i);if(e){s.initialize()}}this._updateContentsModel(t);s.dirty=false;if(!this._isPopulated){return this._populate()}})).catch((async e=>{const t=this._manager.contents.localPath(this._path);const i=n.PathExt.basename(t);void this._handleError(e,this._trans.__("File Load Error for %1",i));throw e}))}_maybeSave(e){const t=this._path;const i=this._manager.contents.get(t,{content:false});return i.then((i=>{var s;if(this.isDisposed){return Promise.reject(new Error("Disposed"))}const n=this._lastModifiedCheckMargin;const a=this._ycontext.get("last_modified");const r=a||((s=this.contentsModel)===null||s===void 0?void 0:s.last_modified);const o=r?new Date(r):new Date;const h=new Date(i.last_modified);if(r&&h.getTime()-o.getTime()>n){return this._timeConflict(o,i,e)}return this._manager.contents.save(t,e)}),(i=>{if(i.response&&i.response.status===404){return this._manager.contents.save(t,e)}throw i}))}async _handleError(e,t){await(0,s.showErrorMessage)(t,e);return}_maybeCheckpoint(e){let t=this._contentsModel&&this._contentsModel.writable;let i=Promise.resolve(void 0);if(!t){return i}if(e){i=this.createCheckpoint().then()}else{i=this.listCheckpoints().then((e=>{t=this._contentsModel&&this._contentsModel.writable;if(!this.isDisposed&&!e.length&&t){return this.createCheckpoint().then()}}))}return i.catch((e=>{if(!e.response||e.response.status!==403){throw e}}))}_timeConflict(e,t,i){const n=new Date(t.last_modified);console.warn(`Last saving performed ${e} `+`while the current file seems to have been saved `+`${n}`);const a=this._trans.__(`"%1" has changed on disk since the last time it was opened or saved.\nDo you want to overwrite the file on disk with the version open here,\nor load the version on disk (revert)?`,this.path);const r=s.Dialog.okButton({label:this._trans.__("Revert")});const o=s.Dialog.warnButton({label:this._trans.__("Overwrite")});return(0,s.showDialog)({title:this._trans.__("File Changed"),body:a,buttons:[s.Dialog.cancelButton(),r,o]}).then((e=>{if(this.isDisposed){return Promise.reject(new Error("Disposed"))}if(e.button.label===this._trans.__("Overwrite")){return this._manager.contents.save(this._path,i)}if(e.button.label===this._trans.__("Revert")){return this.revert().then((()=>t))}return Promise.reject(new Error("Cancel"))}))}_maybeOverWrite(e){const t=this._trans.__('"%1" already exists. Do you want to replace it?',e);const i=s.Dialog.warnButton({label:this._trans.__("Overwrite")});return(0,s.showDialog)({title:this._trans.__("File Overwrite?"),body:t,buttons:[s.Dialog.cancelButton(),i]}).then((t=>{if(this.isDisposed){return Promise.reject(new Error("Disposed"))}if(t.button.label===this._trans.__("Overwrite")){return this._manager.contents.delete(e).then((()=>this._finishSaveAs(e)))}}))}async _finishSaveAs(e){var t,i;this._path=e;await((t=this.sessionContext.session)===null||t===void 0?void 0:t.setPath(e));await((i=this.sessionContext.session)===null||i===void 0?void 0:i.setName(e.split("/").pop()));await this.save();this._ycontext.set("path",this._path);await this._maybeCheckpoint(true)}}var p;(function(e){function t(e,t){t=t||o.nullTranslator;const i=t.load("jupyterlab");const a=s.Dialog.okButton({label:i.__("Save")});return(0,s.showDialog)({title:i.__("Save File As.."),body:new n(e),buttons:[s.Dialog.cancelButton(),a]}).then((e=>{var t;if(e.button.label===i.__("Save")){return(t=e.value)!==null&&t!==void 0?t:undefined}return}))}e.getSavePath=t;function i(){}e.noOp=i;class n extends c.Widget{constructor(e){super({node:a(e)})}getValue(){return this.node.value}}function a(e){const t=document.createElement("input");t.value=e;return t}})(p||(p={}));var u=i(77616);var m=i(78775);var g=i(56806);class f extends u.CodeEditor.Model{constructor(e,t){super({modelDB:t});this._defaultLang="";this._readOnly=false;this._contentChanged=new d.Signal(this);this._stateChanged=new d.Signal(this);this._defaultLang=e||"";const i=new g.YFile;this.switchSharedModel(i,true);this.value.changed.connect(this.triggerContentChange,this);this.sharedModel.dirty=false;this.sharedModel.changed.connect(this._onStateChanged,this)}get contentChanged(){return this._contentChanged}get stateChanged(){return this._stateChanged}get dirty(){return this.sharedModel.dirty}set dirty(e){if(e===this.dirty){return}this.sharedModel.dirty=e}get readOnly(){return this._readOnly}set readOnly(e){if(e===this._readOnly){return}const t=this._readOnly;this._readOnly=e;this.triggerStateChange({name:"readOnly",oldValue:t,newValue:e})}get defaultKernelName(){return""}get defaultKernelLanguage(){return this._defaultLang}toString(){return this.value.text}fromString(e){this.value.text=e}toJSON(){return JSON.parse(this.value.text||"null")}fromJSON(e){this.fromString(JSON.stringify(e))}initialize(){return}triggerStateChange(e){this._stateChanged.emit(e)}triggerContentChange(){this._contentChanged.emit(void 0);this.dirty=true}_onStateChanged(e,t){if(t.stateChange){t.stateChange.forEach((e=>{if(e.name!=="dirty"||e.oldValue!==e.newValue){this.triggerStateChange(e)}}))}}}class y{constructor(){this._isDisposed=false}get name(){return"text"}get contentType(){return"file"}get fileFormat(){return"text"}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed=true}createNew(e,t,i){return new f(e,t)}preferredLanguage(e){const t=m.Mode.findByFileName(e);return t&&t.mode}}class F extends y{get name(){return"base64"}get contentType(){return"file"}get fileFormat(){return"base64"}}class v{constructor(e){this._isDisposed=false;this._widgetCreated=new d.Signal(this);this._translator=e.translator||o.nullTranslator;this._name=e.name;this._readOnly=e.readOnly===undefined?false:e.readOnly;this._defaultFor=e.defaultFor?e.defaultFor.slice():[];this._defaultRendered=(e.defaultRendered||[]).slice();this._fileTypes=e.fileTypes.slice();this._modelName=e.modelName||"text";this._preferKernel=!!e.preferKernel;this._canStartKernel=!!e.canStartKernel;this._shutdownOnClose=!!e.shutdownOnClose;this._toolbarFactory=e.toolbarFactory}get widgetCreated(){return this._widgetCreated}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;d.Signal.clearData(this)}get readOnly(){return this._readOnly}get name(){return this._name}get fileTypes(){return this._fileTypes.slice()}get modelName(){return this._modelName}get defaultFor(){return this._defaultFor.slice()}get defaultRendered(){return this._defaultRendered.slice()}get preferKernel(){return this._preferKernel}get canStartKernel(){return this._canStartKernel}get translator(){return this._translator}get shutdownOnClose(){return this._shutdownOnClose}set shutdownOnClose(e){this._shutdownOnClose=e}createNew(e,t){const i=this.createNewWidget(e,t);let s;if(this._toolbarFactory){s=this._toolbarFactory(i)}else{s=this.defaultToolbarFactory(i)}s.forEach((({name:e,widget:t})=>{i.toolbar.addItem(e,t)}));this._widgetCreated.emit(i);return i}defaultToolbarFactory(e){return[]}}const w="jp-mod-dirty";class x extends s.MainAreaWidget{constructor(e){e.reveal=Promise.all([e.reveal,e.context.ready]);super(e);this.context=e.context;this.context.pathChanged.connect(this._onPathChanged,this);this._onPathChanged(this.context,this.context.path);this.context.model.stateChanged.connect(this._onModelStateChanged,this);void this.context.ready.then((()=>{this._handleDirtyState()}));this.title.changed.connect(this._onTitleChanged,this)}setFragment(e){}async _onTitleChanged(e){const t=/[\/\\:]/;const i=this.title.label;const s=this.context.path.split("/").pop();if(i===s){return}if(i.length>0&&!t.test(i)){const e=this.context.path;await this.context.rename(i);if(this.context.path!==e){return}}this.title.label=s}_onPathChanged(e,t){this.title.label=n.PathExt.basename(e.localPath)}_onModelStateChanged(e,t){if(t.name==="dirty"){this._handleDirtyState()}}_handleDirtyState(){if(this.context.model.dirty&&!this.title.className.includes(w)){this.title.className+=` ${w}`}else{this.title.className=this.title.className.replace(w,"")}}}var b=i(32151);class C extends c.Widget{constructor(e){super();this._changeCallback=e=>{if(!e.data||!e.data[this.mimeType]){return}const t=e.data[this.mimeType];if(typeof t==="string"){if(t!==this._context.model.toString()){this._context.model.fromString(t)}}else if(t!==null&&t!==undefined&&!h.JSONExt.deepEqual(t,this._context.model.toJSON())){this._context.model.fromJSON(t)}};this._fragment="";this._ready=new h.PromiseDelegate;this._isRendering=false;this._renderRequested=false;this.addClass("jp-MimeDocument");this.translator=e.translator||o.nullTranslator;this._trans=this.translator.load("jupyterlab");this.mimeType=e.mimeType;this._dataType=e.dataType||"string";this._context=e.context;this.renderer=e.renderer;const t=this.layout=new c.StackedLayout;t.addWidget(this.renderer);this._context.ready.then((()=>this._render())).then((()=>{if(this.node===document.activeElement){b.MessageLoop.sendMessage(this.renderer,c.Widget.Msg.ActivateRequest)}this._monitor=new n.ActivityMonitor({signal:this._context.model.contentChanged,timeout:e.renderTimeout});this._monitor.activityStopped.connect(this.update,this);this._ready.resolve(undefined)})).catch((e=>{requestAnimationFrame((()=>{this.dispose()}));void(0,s.showErrorMessage)(this._trans.__("Renderer Failure: %1",this._context.path),e)}))}[s.Printing.symbol](){return s.Printing.getPrintFunction(this.renderer)}get ready(){return this._ready.promise}setFragment(e){this._fragment=e;this.update()}dispose(){if(this.isDisposed){return}if(this._monitor){this._monitor.dispose()}this._monitor=null;super.dispose()}onUpdateRequest(e){if(this._context.isReady){void this._render();this._fragment=""}}async _render(){if(this.isDisposed){return}if(this._isRendering){this._renderRequested=true;return}this._renderRequested=false;const e=this._context;const t=e.model;const i={};if(this._dataType==="string"){i[this.mimeType]=t.toString()}else{i[this.mimeType]=t.toJSON()}const n=new r.MimeModel({data:i,callback:this._changeCallback,metadata:{fragment:this._fragment}});try{this._isRendering=true;await this.renderer.renderModel(n);this._isRendering=false;if(this._renderRequested){return this._render()}}catch(a){requestAnimationFrame((()=>{this.dispose()}));void(0,s.showErrorMessage)(this._trans.__("Renderer Failure: %1",e.path),a)}}}class T extends x{setFragment(e){this.content.setFragment(e)}}class D extends v{constructor(e){super(O.createRegistryOptions(e));this._rendermime=e.rendermime;this._renderTimeout=e.renderTimeout||1e3;this._dataType=e.dataType||"string";this._fileType=e.primaryFileType;this._factory=e.factory}createNewWidget(e){var t,i;const s=this._fileType;const n=(s===null||s===void 0?void 0:s.mimeTypes.length)?s.mimeTypes[0]:"text/plain";const a=this._rendermime.clone({resolver:e.urlResolver});let r;if(this._factory&&this._factory.mimeTypes.includes(n)){r=this._factory.createRenderer({mimeType:n,resolver:a.resolver,sanitizer:a.sanitizer,linkHandler:a.linkHandler,latexTypesetter:a.latexTypesetter})}else{r=a.createRenderer(n)}const o=new C({context:e,renderer:r,mimeType:n,renderTimeout:this._renderTimeout,dataType:this._dataType});o.title.icon=s===null||s===void 0?void 0:s.icon;o.title.iconClass=(t=s===null||s===void 0?void 0:s.iconClass)!==null&&t!==void 0?t:"";o.title.iconLabel=(i=s===null||s===void 0?void 0:s.iconLabel)!==null&&i!==void 0?i:"";const h=new T({content:o,context:e});return h}}var O;(function(e){function t(e){return Object.assign(Object.assign({},e),{readOnly:true})}e.createRegistryOptions=t})(O||(O={}));var S=i(92481);var k=i(62867);class M{constructor(e={}){this._modelFactories=Object.create(null);this._widgetFactories=Object.create(null);this._defaultWidgetFactory="";this._defaultWidgetFactoryOverrides=Object.create(null);this._defaultWidgetFactories=Object.create(null);this._defaultRenderedWidgetFactories=Object.create(null);this._widgetFactoriesForFileType=Object.create(null);this._fileTypes=[];this._extenders=Object.create(null);this._changed=new d.Signal(this);this._isDisposed=false;const t=e.textModelFactory;this.translator=e.translator||o.nullTranslator;if(t&&t.name!=="text"){throw new Error("Text model factory must have the name `text`")}this._modelFactories["text"]=t||new y;const i=e.initialFileTypes||M.getDefaultFileTypes(this.translator);i.forEach((e=>{const t=Object.assign(Object.assign({},M.getFileTypeDefaults(this.translator)),e);this._fileTypes.push(t)}))}get changed(){return this._changed}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;for(const e in this._modelFactories){this._modelFactories[e].dispose()}for(const e in this._widgetFactories){this._widgetFactories[e].dispose()}for(const e in this._extenders){this._extenders[e].length=0}this._fileTypes.length=0;d.Signal.clearData(this)}addWidgetFactory(e){const t=e.name.toLowerCase();if(!t||t==="default"){throw Error("Invalid factory name")}if(this._widgetFactories[t]){console.warn(`Duplicate registered factory ${t}`);return new l.DisposableDelegate(P.noOp)}this._widgetFactories[t]=e;for(const i of e.defaultFor||[]){if(e.fileTypes.indexOf(i)===-1){continue}if(i==="*"){this._defaultWidgetFactory=t}else{this._defaultWidgetFactories[i]=t}}for(const i of e.defaultRendered||[]){if(e.fileTypes.indexOf(i)===-1){continue}this._defaultRenderedWidgetFactories[i]=t}for(const i of e.fileTypes){if(!this._widgetFactoriesForFileType[i]){this._widgetFactoriesForFileType[i]=[]}this._widgetFactoriesForFileType[i].push(t)}this._changed.emit({type:"widgetFactory",name:t,change:"added"});return new l.DisposableDelegate((()=>{delete this._widgetFactories[t];if(this._defaultWidgetFactory===t){this._defaultWidgetFactory=""}for(const e of Object.keys(this._defaultWidgetFactories)){if(this._defaultWidgetFactories[e]===t){delete this._defaultWidgetFactories[e]}}for(const e of Object.keys(this._defaultRenderedWidgetFactories)){if(this._defaultRenderedWidgetFactories[e]===t){delete this._defaultRenderedWidgetFactories[e]}}for(const e of Object.keys(this._widgetFactoriesForFileType)){k.ArrayExt.removeFirstOf(this._widgetFactoriesForFileType[e],t);if(this._widgetFactoriesForFileType[e].length===0){delete this._widgetFactoriesForFileType[e]}}for(const e of Object.keys(this._defaultWidgetFactoryOverrides)){if(this._defaultWidgetFactoryOverrides[e]===t){delete this._defaultWidgetFactoryOverrides[e]}}this._changed.emit({type:"widgetFactory",name:t,change:"removed"})}))}addModelFactory(e){const t=e.name.toLowerCase();if(this._modelFactories[t]){console.warn(`Duplicate registered factory ${t}`);return new l.DisposableDelegate(P.noOp)}this._modelFactories[t]=e;this._changed.emit({type:"modelFactory",name:t,change:"added"});return new l.DisposableDelegate((()=>{delete this._modelFactories[t];this._changed.emit({type:"modelFactory",name:t,change:"removed"})}))}addWidgetExtension(e,t){e=e.toLowerCase();if(!(e in this._extenders)){this._extenders[e]=[]}const i=this._extenders[e];const s=k.ArrayExt.firstIndexOf(i,t);if(s!==-1){console.warn(`Duplicate registered extension for ${e}`);return new l.DisposableDelegate(P.noOp)}this._extenders[e].push(t);this._changed.emit({type:"widgetExtension",name:e,change:"added"});return new l.DisposableDelegate((()=>{k.ArrayExt.removeFirstOf(this._extenders[e],t);this._changed.emit({type:"widgetExtension",name:e,change:"removed"})}))}addFileType(e){const t=Object.assign(Object.assign(Object.assign({},M.getFileTypeDefaults(this.translator)),e),!(e.icon||e.iconClass)&&{icon:S.fileIcon});this._fileTypes.push(t);this._changed.emit({type:"fileType",name:t.name,change:"added"});return new l.DisposableDelegate((()=>{k.ArrayExt.removeFirstOf(this._fileTypes,t);this._changed.emit({type:"fileType",name:e.name,change:"removed"})}))}preferredWidgetFactories(e){const t=new Set;const i=this.getFileTypesForPath(n.PathExt.basename(e));i.forEach((e=>{if(e.name in this._defaultWidgetFactoryOverrides){t.add(this._defaultWidgetFactoryOverrides[e.name])}}));i.forEach((e=>{if(e.name in this._defaultWidgetFactories){t.add(this._defaultWidgetFactories[e.name])}}));i.forEach((e=>{if(e.name in this._defaultRenderedWidgetFactories){t.add(this._defaultRenderedWidgetFactories[e.name])}}));if(this._defaultWidgetFactory){t.add(this._defaultWidgetFactory)}i.forEach((e=>{if(e.name in this._widgetFactoriesForFileType){(0,k.each)(this._widgetFactoriesForFileType[e.name],(e=>{t.add(e)}))}}));if("*"in this._widgetFactoriesForFileType){(0,k.each)(this._widgetFactoriesForFileType["*"],(e=>{t.add(e)}))}const s=[];t.forEach((e=>{const t=this._widgetFactories[e];if(!t){return}const i=t.modelName||"text";if(i in this._modelFactories){s.push(t)}}));return s}defaultRenderedWidgetFactory(e){const t=this.getFileTypesForPath(n.PathExt.basename(e));let i=undefined;for(const s of t){if(s.name in this._defaultRenderedWidgetFactories){i=this._widgetFactories[this._defaultRenderedWidgetFactories[s.name]];break}}return i||this.defaultWidgetFactory(e)}defaultWidgetFactory(e){if(!e){return this._widgetFactories[this._defaultWidgetFactory]}return this.preferredWidgetFactories(e)[0]}setDefaultWidgetFactory(e,t){e=e.toLowerCase();if(!this.getFileType(e)){throw Error(`Cannot find file type ${e}`)}if(!t){if(this._defaultWidgetFactoryOverrides[e]){delete this._defaultWidgetFactoryOverrides[e]}return}if(!this.getWidgetFactory(t)){throw Error(`Cannot find widget factory ${t}`)}t=t.toLowerCase();const i=this._widgetFactoriesForFileType[e];if(t!==this._defaultWidgetFactory&&!(i&&i.includes(t))){throw Error(`Factory ${t} cannot view file type ${e}`)}this._defaultWidgetFactoryOverrides[e]=t}widgetFactories(){return(0,k.map)(Object.keys(this._widgetFactories),(e=>this._widgetFactories[e]))}modelFactories(){return(0,k.map)(Object.keys(this._modelFactories),(e=>this._modelFactories[e]))}widgetExtensions(e){e=e.toLowerCase();if(!(e in this._extenders)){return(0,k.empty)()}return new k.ArrayIterator(this._extenders[e])}fileTypes(){return new k.ArrayIterator(this._fileTypes)}getWidgetFactory(e){return this._widgetFactories[e.toLowerCase()]}getModelFactory(e){return this._modelFactories[e.toLowerCase()]}getFileType(e){e=e.toLowerCase();return(0,k.find)(this._fileTypes,(t=>t.name.toLowerCase()===e))}getKernelPreference(e,t,i){t=t.toLowerCase();const s=this._widgetFactories[t];if(!s){return void 0}const a=this.getModelFactory(s.modelName||"text");if(!a){return void 0}const r=a.preferredLanguage(n.PathExt.basename(e));const o=i&&i.name;const h=i&&i.id;return{id:h,name:o,language:r,shouldStart:s.preferKernel,canStart:s.canStartKernel,shutdownOnDispose:s.shutdownOnClose}}getFileTypeForModel(e){switch(e.type){case"directory":return(0,k.find)(this._fileTypes,(e=>e.contentType==="directory"))||M.getDefaultDirectoryFileType(this.translator);case"notebook":return(0,k.find)(this._fileTypes,(e=>e.contentType==="notebook"))||M.getDefaultNotebookFileType(this.translator);default:if(e.name||e.path){const t=e.name||n.PathExt.basename(e.path);const i=this.getFileTypesForPath(t);if(i.length>0){return i[0]}}return this.getFileType("text")||M.getDefaultTextFileType(this.translator)}}getFileTypesForPath(e){const t=[];const i=n.PathExt.basename(e);let s=(0,k.find)(this._fileTypes,(e=>!!(e.pattern&&i.match(e.pattern)!==null)));if(s){t.push(s)}let a=P.extname(i);while(a.length>1){s=(0,k.find)(this._fileTypes,(e=>e.extensions.map((e=>e.toLowerCase())).indexOf(a)!==-1));if(s){t.push(s)}a="."+a.split(".").slice(2).join(".")}return t}}(function(e){function t(e){e=e||o.nullTranslator;const t=e===null||e===void 0?void 0:e.load("jupyterlab");return{name:"default",displayName:t.__("default"),extensions:[],mimeTypes:[],contentType:"file",fileFormat:"text"}}e.getFileTypeDefaults=t;function i(e){e=e||o.nullTranslator;const i=e===null||e===void 0?void 0:e.load("jupyterlab");const s=t(e);return Object.assign(Object.assign({},s),{name:"text",displayName:i.__("Text"),mimeTypes:["text/plain"],extensions:[".txt"],icon:S.fileIcon})}e.getDefaultTextFileType=i;function s(e){e=e||o.nullTranslator;const i=e===null||e===void 0?void 0:e.load("jupyterlab");return Object.assign(Object.assign({},t(e)),{name:"notebook",displayName:i.__("Notebook"),mimeTypes:["application/x-ipynb+json"],extensions:[".ipynb"],contentType:"notebook",fileFormat:"json",icon:S.notebookIcon})}e.getDefaultNotebookFileType=s;function n(e){e=e||o.nullTranslator;const i=e===null||e===void 0?void 0:e.load("jupyterlab");return Object.assign(Object.assign({},t(e)),{name:"directory",displayName:i.__("Directory"),extensions:[],mimeTypes:["text/directory"],contentType:"directory",icon:S.folderIcon})}e.getDefaultDirectoryFileType=n;function a(e){e=e||o.nullTranslator;const t=e===null||e===void 0?void 0:e.load("jupyterlab");return[i(e),s(e),n(e),{name:"markdown",displayName:t.__("Markdown File"),extensions:[".md"],mimeTypes:["text/markdown"],icon:S.markdownIcon},{name:"PDF",displayName:t.__("PDF File"),extensions:[".pdf"],mimeTypes:["application/pdf"],icon:S.pdfIcon},{name:"python",displayName:t.__("Python File"),extensions:[".py"],mimeTypes:["text/x-python"],icon:S.pythonIcon},{name:"json",displayName:t.__("JSON File"),extensions:[".json"],mimeTypes:["application/json"],icon:S.jsonIcon},{name:"julia",displayName:t.__("Julia File"),extensions:[".jl"],mimeTypes:["text/x-julia"],icon:S.juliaIcon},{name:"csv",displayName:t.__("CSV File"),extensions:[".csv"],mimeTypes:["text/csv"],icon:S.spreadsheetIcon},{name:"tsv",displayName:t.__("TSV File"),extensions:[".tsv"],mimeTypes:["text/csv"],icon:S.spreadsheetIcon},{name:"r",displayName:t.__("R File"),mimeTypes:["text/x-rsrc"],extensions:[".R"],icon:S.rKernelIcon},{name:"yaml",displayName:t.__("YAML File"),mimeTypes:["text/x-yaml","text/yaml"],extensions:[".yaml",".yml"],icon:S.yamlIcon},{name:"svg",displayName:t.__("Image"),mimeTypes:["image/svg+xml"],extensions:[".svg"],icon:S.imageIcon,fileFormat:"base64"},{name:"tiff",displayName:t.__("Image"),mimeTypes:["image/tiff"],extensions:[".tif",".tiff"],icon:S.imageIcon,fileFormat:"base64"},{name:"jpeg",displayName:t.__("Image"),mimeTypes:["image/jpeg"],extensions:[".jpg",".jpeg"],icon:S.imageIcon,fileFormat:"base64"},{name:"gif",displayName:t.__("Image"),mimeTypes:["image/gif"],extensions:[".gif"],icon:S.imageIcon,fileFormat:"base64"},{name:"png",displayName:t.__("Image"),mimeTypes:["image/png"],extensions:[".png"],icon:S.imageIcon,fileFormat:"base64"},{name:"bmp",displayName:t.__("Image"),mimeTypes:["image/bmp"],extensions:[".bmp"],icon:S.imageIcon,fileFormat:"base64"}]}e.getDefaultFileTypes=a})(M||(M={}));var P;(function(e){function t(e){const t=n.PathExt.basename(e).split(".");t.shift();const i="."+t.join(".");return i.toLowerCase()}e.extname=t;function i(){}e.noOp=i})(P||(P={}))}}]);