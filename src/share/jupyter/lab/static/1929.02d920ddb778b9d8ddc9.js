(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[1929],{11929:(e,t,s)=>{"use strict";s.r(t);s.d(t,{AttachmentsCell:()=>Be,AttachmentsCellModel:()=>z,Cell:()=>We,CellDragUtils:()=>c,CellFooter:()=>k,CellHeader:()=>O,CellModel:()=>T,CodeCell:()=>Ve,CodeCellModel:()=>X,Collapser:()=>y,InputArea:()=>I,InputCollapser:()=>v,InputPlaceholder:()=>ie,InputPrompt:()=>F,MARKDOWN_HEADING_COLLAPSED:()=>De,MarkdownCell:()=>Le,MarkdownCellModel:()=>q,OutputCollapser:()=>w,OutputPlaceholder:()=>oe,Placeholder:()=>ae,RawCell:()=>Re,RawCellModel:()=>G,isCodeCellModel:()=>$,isMarkdownCellModel:()=>U,isRawCellModel:()=>J});var n=s(62867);var a=s(98723);const i=5;const o="jp-dragImage";const r="jp-dragImage-singlePrompt";const d="jp-dragImage-content";const l="jp-dragImage-prompt";const u="jp-dragImage-multipleBack";var c;(function(e){function t(e,t,s){let a=-1;while(e&&e.parentElement){if(s(e)){(0,n.each)(t,((t,s)=>{if(t.node===e){a=s;return false}}));break}e=e.parentElement}return a}e.findCell=t;function s(e,t){let s;if(e){if(e.editorWidget.node.contains(t)){s="input"}else if(e.promptNode.contains(t)){s="prompt"}else{s="cell"}}else{s="unknown"}return s}e.detectTargetArea=s;function c(e,t,s,n){const a=Math.abs(s-e);const o=Math.abs(n-t);return a>=i||o>=i}e.shouldStartDrag=c;function h(e,t){const s=t.length;let n;if(e.model.type==="code"){const t=e.model.executionCount;n=" ";if(t){n=t.toString()}}else{n=""}const i=e.model.value.text.split("\n")[0].slice(0,26);if(s>1){if(n!==""){return a.VirtualDOM.realize(a.h.div(a.h.div({className:o},a.h.span({className:l},"["+n+"]:"),a.h.span({className:d},i)),a.h.div({className:u},"")))}else{return a.VirtualDOM.realize(a.h.div(a.h.div({className:o},a.h.span({className:l}),a.h.span({className:d},i)),a.h.div({className:u},"")))}}else{if(n!==""){return a.VirtualDOM.realize(a.h.div(a.h.div({className:`${o} ${r}`},a.h.span({className:l},"["+n+"]:"),a.h.span({className:d},i))))}else{return a.VirtualDOM.realize(a.h.div(a.h.div({className:`${o} ${r}`},a.h.span({className:l}),a.h.span({className:d},i))))}}}e.createCellDragImage=h})(c||(c={}));var h=s(26825);var p=s(33513);var m=s(2411);const g="jp-Collapser";const f="jp-Collapser-child";const C="jp-InputCollapser";const _="jp-OutputCollapser";class y extends h.ReactWidget{constructor(){super();this.addClass(g)}get collapsed(){return false}render(){const e=f;return m.createElement("div",{className:e,onClick:e=>this.handleClick(e)})}}class v extends y{constructor(){super();this.addClass(C)}get collapsed(){var e;const t=(e=this.parent)===null||e===void 0?void 0:e.parent;if(t){return t.inputHidden}else{return false}}handleClick(e){var t;const s=(t=this.parent)===null||t===void 0?void 0:t.parent;if(s){s.inputHidden=!s.inputHidden}this.update()}}class w extends y{constructor(){super();this.addClass(_)}get collapsed(){var e;const t=(e=this.parent)===null||e===void 0?void 0:e.parent;if(t){return t.outputHidden}else{return false}}handleClick(e){var t,s;const n=(t=this.parent)===null||t===void 0?void 0:t.parent;if(n){n.outputHidden=!n.outputHidden;if(n.outputHidden){let e=(s=n.parent)===null||s===void 0?void 0:s.node;if(e){p.ElementExt.scrollIntoViewIfNeeded(e,n.node)}}}this.update()}}var x=s(61389);const b="jp-CellHeader";const S="jp-CellFooter";class O extends x.Widget{constructor(){super();this.addClass(b)}}class k extends x.Widget{constructor(){super();this.addClass(S)}}var j=s(77616);var D=s(78775);const E="jp-InputArea";const M="jp-InputArea-prompt";const N="jp-InputPrompt";const A="jp-InputArea-editor";class I extends x.Widget{constructor(e){super();this.addClass(E);const t=this.model=e.model;const s=this.contentFactory=e.contentFactory||I.defaultContentFactory;const n=this._prompt=s.createInputPrompt();n.addClass(M);const a={model:t,factory:s.editorFactory,updateOnShow:e.updateOnShow};const i=this._editor=new j.CodeEditorWrapper(a);i.addClass(A);const o=this.layout=new x.PanelLayout;o.addWidget(n);if(!e.placeholder){o.addWidget(i)}}get editorWidget(){return this._editor}get editor(){return this._editor.editor}get promptNode(){return this._prompt.node}renderInput(e){const t=this.layout;if(this._rendered){this._rendered.parent=null}this._editor.hide();this._rendered=e;t.addWidget(e)}showEditor(){if(this._rendered){this._rendered.parent=null}this._editor.show()}setPrompt(e){this._prompt.executionCount=e}dispose(){if(this.isDisposed){return}this._prompt=null;this._editor=null;this._rendered=null;super.dispose()}}(function(e){class t{constructor(t={}){this._editor=t.editorFactory||e.defaultEditorFactory}get editorFactory(){return this._editor}createInputPrompt(){return new F}}e.ContentFactory=t;function s(){const e=new D.CodeMirrorEditorFactory;return e.newInlineEditor}e.defaultEditorFactory=s();e.defaultContentFactory=new t({})})(I||(I={}));class F extends x.Widget{constructor(){super();this._executionCount=null;this.addClass(N)}get executionCount(){return this._executionCount}set executionCount(e){this._executionCount=e;if(e===null){this.node.textContent=" "}else{this.node.textContent=`[${e||" "}]:`}}}var H=s(9727);var P=s(75138);var W=s(66934);var V=s(56806);var B=s(18584);var L=undefined&&undefined.__rest||function(e,t){var s={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0)s[n]=e[n];if(e!=null&&typeof Object.getOwnPropertySymbols==="function")for(var a=0,n=Object.getOwnPropertySymbols(e);a<n.length;a++){if(t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a]))s[n[a]]=e[n[a]]}return s};const R=V.createMutex();function $(e){return e.type==="code"}function U(e){return e.type==="markdown"}function J(e){return e.type==="raw"}class T extends j.CodeEditor.Model{constructor(e){var t;super({modelDB:e.modelDB,id:e.id||((t=e.cell)===null||t===void 0?void 0:t.id)||H.UUID.uuid4()});this.contentChanged=new P.Signal(this);this.stateChanged=new P.Signal(this);this.value.changed.connect(this.onGenericChange,this);const s=this.modelDB.createValue("type");s.set(this.type);const n=this.modelDB.createMap("metadata");n.changed.connect(this.onModelDBMetadataChange,this);n.changed.connect(this.onGenericChange,this);const a=e.cell;const i=this.modelDB.createValue("trusted");i.changed.connect(this.onTrustedChanged,this);if(!a){i.set(false);return}i.set(!!a.metadata["trusted"]);delete a.metadata["trusted"];if(Array.isArray(a.source)){this.value.text=a.source.map((e=>e.replace(/\r\n/g,"\n").replace(/\r/g,"\n"))).join("")}else{this.value.text=a.source.replace(/\r\n/g,"\n").replace(/\r/g,"\n")}const o=H.JSONExt.deepCopy(a.metadata);if(this.type!=="raw"){delete o["format"]}if(this.type!=="code"){delete o["collapsed"];delete o["scrolled"]}for(const r in o){n.set(r,o[r])}}get type(){return"raw"}get id(){return this.sharedModel.getId()}get metadata(){return this.modelDB.get("metadata")}get trusted(){return this.modelDB.getValue("trusted")}set trusted(e){const t=this.trusted;if(t===e){return}this.modelDB.setValue("trusted",e)}toJSON(){const e=Object.create(null);for(const t of this.metadata.keys()){const s=JSON.parse(JSON.stringify(this.metadata.get(t)));e[t]=s}if(this.trusted){e["trusted"]=true}return{cell_type:this.type,source:this.value.text,metadata:e}}onTrustedChanged(e,t){}switchSharedModel(e,t){if(t){const t=e.getMetadata();if(t){this._updateModelDBMetadata(t)}}super.switchSharedModel(e,t)}onModelDBMetadataChange(e,t){const s=this.sharedModel.getMetadata();R((()=>{switch(t.type){case"add":this._changeCellMetadata(s,t);break;case"change":this._changeCellMetadata(s,t);break;case"remove":delete s[t.key];break;default:throw new Error(`Invalid event type: ${t.type}`)}this.sharedModel.setMetadata(s)}))}_changeCellMetadata(e,t){switch(t.key){case"jupyter":e.jupyter=t.newValue;break;case"collapsed":e.collapsed=t.newValue;break;case"name":e.name=t.newValue;break;case"scrolled":e.scrolled=t.newValue;break;case"tags":e.tags=t.newValue;break;case"trusted":e.trusted=t.newValue;break;default:e[t.key]=t.newValue}}_onSharedModelChanged(e,t){super._onSharedModelChanged(e,t);R((()=>{var e;if(t.metadataChange){const s=(e=t.metadataChange)===null||e===void 0?void 0:e.newValue;if(s){this._updateModelDBMetadata(s)}}}))}_updateModelDBMetadata(e){Object.keys(e).map((t=>{switch(t){case"collapsed":this.metadata.set("collapsed",e.jupyter);break;case"jupyter":this.metadata.set("jupyter",e.jupyter);break;case"name":this.metadata.set("name",e.name);break;case"scrolled":this.metadata.set("scrolled",e.scrolled);break;case"tags":this.metadata.set("tags",e.tags);break;case"trusted":this.metadata.set("trusted",e.trusted);break;default:this.metadata.set(t,e[t])}}))}onGenericChange(){this.contentChanged.emit(void 0)}}class z extends T{constructor(e){super(e);const t=e.contentFactory||z.defaultContentFactory;let s;const n=e.cell;if(n&&(n.cell_type==="raw"||n.cell_type==="markdown")){s=n.attachments}this._attachments=t.createAttachmentsModel({values:s,modelDB:this.modelDB});this._attachments.stateChanged.connect(this.onGenericChange,this)}get attachments(){return this._attachments}toJSON(){const e=super.toJSON();if(this.attachments.length){e.attachments=this.attachments.toJSON()}return e}}(function(e){class t{createAttachmentsModel(e){return new W.AttachmentsModel(e)}}e.ContentFactory=t;e.defaultContentFactory=new t})(z||(z={}));class G extends z{get type(){return"raw"}toJSON(){const e=super.toJSON();e.id=this.id;return e}}class q extends z{constructor(e){super(e);this.mimeType="text/x-ipythongfm"}get type(){return"markdown"}toJSON(){const e=super.toJSON();e.id=this.id;return e}}class X extends T{constructor(e){var t;super(e);this._executedCode="";this._isDirty=false;const s=e.contentFactory||X.defaultContentFactory;const n=this.trusted;const a=e.cell;let i=[];const o=this.modelDB.createValue("executionCount");if(!o.get()){if(a&&a.cell_type==="code"){o.set(a.execution_count||null);i=(t=a.outputs)!==null&&t!==void 0?t:[];if(a.execution_count!=null){this._executedCode=this.value.text.trim()}}else{o.set(null)}}this.value.changed.connect(this._onValueChanged,this);o.changed.connect(this._onExecutionCountChanged,this);R((()=>{const e=this.sharedModel;e.setOutputs(i)}));this._outputs=s.createOutputArea({trusted:n,values:i});this._outputs.changed.connect(this.onGenericChange,this);this._outputs.changed.connect(this.onModelDBOutputsChange,this);this.metadata.changed.connect(K.collapseChanged,this);if(this.metadata.has("collapsed")){const e=this.metadata.get("collapsed");K.collapseChanged(this.metadata,{type:"change",key:"collapsed",oldValue:e,newValue:e})}else if(this.metadata.has("jupyter")){const e=this.metadata.get("jupyter");if(e.hasOwnProperty("outputs_hidden")){K.collapseChanged(this.metadata,{type:"change",key:"jupyter",oldValue:e,newValue:e})}}}switchSharedModel(e,t){if(t){this.clearExecution();e.getOutputs().forEach((e=>this._outputs.add(e)))}super.switchSharedModel(e,t)}get type(){return"code"}get executionCount(){return this.modelDB.has("executionCount")?this.modelDB.getValue("executionCount"):null}set executionCount(e){const t=this.executionCount;if(e===t){return}this.modelDB.setValue("executionCount",e||null)}get isDirty(){return this._isDirty}_setDirty(e){if(e!==this._isDirty){if(!e){this._executedCode=this.value.text.trim()}this._isDirty=e;this.stateChanged.emit({name:"isDirty",oldValue:!e,newValue:e})}}clearExecution(){this.outputs.clear();this.executionCount=null;this._setDirty(false);this.metadata.delete("execution")}get outputs(){return this._outputs}dispose(){if(this.isDisposed){return}this._outputs.dispose();this._outputs=null;super.dispose()}toJSON(){const e=super.toJSON();e.execution_count=this.executionCount||null;e.outputs=this.outputs.toJSON();e.id=this.id;return e}onTrustedChanged(e,t){if(this._outputs){this._outputs.trusted=t.newValue}this.stateChanged.emit({name:"trusted",oldValue:t.oldValue,newValue:t.newValue})}onModelDBOutputsChange(e,t){const s=this.sharedModel;R((()=>{switch(t.type){case"add":{const e=t.newValues.map((e=>e.toJSON()));s.updateOutputs(t.newIndex,t.newIndex+e.length,e);break}case"set":{const e=t.newValues.map((e=>e.toJSON()));s.updateOutputs(t.oldIndex,t.oldValues.length,e);break}case"remove":s.updateOutputs(t.oldIndex,t.oldValues.length);break;default:throw new Error(`Invalid event type: ${t.type}`)}}))}_onValueChanged(){if(this.executionCount!==null){this._setDirty(this._executedCode!==this.value.text.trim())}}_onSharedModelChanged(e,t){super._onSharedModelChanged(e,t);R((()=>{if(t.outputsChange){this.clearExecution();e.getOutputs().forEach((e=>this._outputs.add(e)))}if(t.executionCountChange){this.executionCount=t.executionCountChange.newValue?t.executionCountChange.newValue:null}}))}_onExecutionCountChanged(e,t){const s=this.sharedModel;R((()=>{s.execution_count=t.newValue?t.newValue:null}));this.contentChanged.emit(void 0);this.stateChanged.emit({name:"executionCount",oldValue:t.oldValue,newValue:t.newValue});if(t.newValue&&this.isDirty){this._setDirty(false)}}}(function(e){class t{createOutputArea(e){return new B.OutputAreaModel(e)}}e.ContentFactory=t;e.defaultContentFactory=new t})(X||(X={}));var K;(function(e){function t(e,t){if(t.key==="collapsed"){const s=e.get("jupyter")||{};const{outputs_hidden:n}=s,a=L(s,["outputs_hidden"]);if(n!==t.newValue){if(t.newValue!==undefined){a["outputs_hidden"]=t.newValue}if(Object.keys(a).length===0){e.delete("jupyter")}else{e.set("jupyter",a)}}}else if(t.key==="jupyter"){const s=t.newValue||{};if(s.hasOwnProperty("outputs_hidden")){e.set("collapsed",s.outputs_hidden)}else{e.delete("collapsed")}}}e.collapseChanged=t})(K||(K={}));var Q=s(92481);const Y="jp-Placeholder";const Z="jp-Placeholder-prompt jp-InputPrompt";const ee="jp-Placeholder-prompt jp-OutputPrompt";const te="jp-Placeholder-content";const se="jp-InputPlaceholder";const ne="jp-OutputPlaceholder";class ae extends h.ReactWidget{constructor(e){super();this.addClass(Y);this._callback=e}handleClick(e){const t=this._callback;t(e)}}class ie extends ae{constructor(e){super(e);this.addClass(se)}render(){return[m.createElement("div",{className:Z,key:"input"}),m.createElement("div",{className:te,onClick:e=>this.handleClick(e),key:"content"},m.createElement(Q.ellipsesIcon.react,{className:"jp-MoreHorizIcon",elementPosition:"center",height:"auto",width:"32px"}))]}}class oe extends ae{constructor(e){super(e);this.addClass(ne)}render(){return[m.createElement("div",{className:ee,key:"output"}),m.createElement("div",{className:te,onClick:e=>this.handleClick(e),key:"content"},m.createElement(Q.ellipsesIcon.react,{className:"jp-MoreHorizIcon",elementPosition:"center",height:"auto",width:"32px"}))]}}var re=s(13917);var de=s.n(re);var le=s(83875);var ue=s(72805);const ce="jp-CellResizeHandle";const he="jp-mod-resizedCell";class pe extends x.Widget{constructor(e){super();this.targetNode=e;this._isActive=false;this._isDragging=false;this._protectedWidth=10;this.addClass(ce)}onAfterAttach(e){super.onAfterAttach(e);this.node.addEventListener("dblclick",this);this.node.addEventListener("mousedown",this)}onAfterDetach(e){super.onAfterAttach(e);this.node.removeEventListener("dblclick",this);this.node.removeEventListener("mousedown",this)}handleEvent(e){var t,s;switch(e.type){case"dblclick":(t=this.targetNode.parentNode)===null||t===void 0?void 0:t.childNodes.forEach((e=>{e.classList.remove(he)}));document.documentElement.style.setProperty("--jp-side-by-side-resized-cell","");this._isActive=false;break;case"mousedown":this._mouseOffset=e.clientX-this.node.getBoundingClientRect().x;this._isDragging=true;if(!this._isActive){(s=this.targetNode.parentNode)===null||s===void 0?void 0:s.childNodes.forEach((e=>{e.classList.add(he)}));this._isActive=true}window.addEventListener("mousemove",this);window.addEventListener("mouseup",this);break;case"mousemove":{if(!this._isActive||!this._isDragging){return}const t=this.targetNode.getBoundingClientRect();const s=e.clientX-t.x-this._mouseOffset;const n=1-Math.min(Math.max(s,this._protectedWidth),t.width-this._protectedWidth)/(t.width-this._protectedWidth);if(Math.round(n*100)%10==0){document.documentElement.style.setProperty("--jp-side-by-side-resized-cell",n+"fr")}break}case"mouseup":this._isDragging=false;window.removeEventListener("mousemove",this);window.removeEventListener("mouseup",this);break;default:break}}}const me="jp-Cell";const ge="jp-Cell-header";const fe="jp-Cell-footer";const Ce="jp-Cell-inputWrapper";const _e="jp-Cell-outputWrapper";const ye="jp-Cell-inputArea";const ve="jp-Cell-outputArea";const we="jp-Cell-inputCollapser";const xe="jp-Cell-outputCollapser";const be="jp-mod-readOnly";const Se="jp-mod-dirty";const Oe="jp-CodeCell";const ke="jp-MarkdownCell";const je="jp-MarkdownOutput";const De="jp-MarkdownHeadingCollapsed";const Ee="jp-collapseHeadingButton";const Me="jp-showHiddenCellsButton";const Ne="jp-RawCell";const Ae="jp-mod-rendered";const Ie="jp-mod-noOutputs";const Fe="Type Markdown and LaTeX: $ Î±^2 $";const He=1e3;const Pe="application/x-jupyter-icontentsrich";class We extends x.Widget{constructor(e){super();this._readOnly=false;this._inputHidden=false;this._syncCollapse=false;this._syncEditable=false;this.addClass(me);const t=this._model=e.model;const s=this.contentFactory=e.contentFactory||We.defaultContentFactory;this.layout=new x.PanelLayout;const n=s.createCellHeader();n.addClass(ge);this.layout.addWidget(n);const a=this._inputWrapper=new x.Panel;a.addClass(Ce);const i=new v;i.addClass(we);const o=this._input=new I({model:t,contentFactory:s,updateOnShow:e.updateEditorOnShow,placeholder:e.placeholder});o.addClass(ye);a.addWidget(i);a.addWidget(o);this.layout.addWidget(a);this._inputPlaceholder=new ie((()=>{this.inputHidden=!this.inputHidden}));const r=this.contentFactory.createCellFooter();r.addClass(fe);this.layout.addWidget(r);if(e.editorConfig){let t={};Object.keys(e.editorConfig).forEach((s=>{var n,a;t[s]=(a=(n=e.editorConfig)===null||n===void 0?void 0:n[s])!==null&&a!==void 0?a:null}));this.editor.setOptions(t)}t.metadata.changed.connect(this.onMetadataChanged,this)}initializeState(){this.loadCollapseState();this.loadEditableState();return this}get promptNode(){if(!this._inputHidden){return this._input.promptNode}else{return this._inputPlaceholder.node.firstElementChild}}get editorWidget(){return this._input.editorWidget}get editor(){return this._input.editor}get model(){return this._model}get inputArea(){return this._input}get readOnly(){return this._readOnly}set readOnly(e){if(e===this._readOnly){return}this._readOnly=e;if(this.syncEditable){this.saveEditableState()}this.update()}saveEditableState(){const{metadata:e}=this.model;const t=e.get("editable");if(this.readOnly&&t===false||!this.readOnly&&t===undefined){return}if(this.readOnly){this.model.metadata.set("editable",false)}else{this.model.metadata.delete("editable")}}loadEditableState(){this.readOnly=this.model.metadata.get("editable")===false}get ready(){return Promise.resolve(undefined)}setPrompt(e){this._input.setPrompt(e)}get inputHidden(){return this._inputHidden}set inputHidden(e){if(this._inputHidden===e){return}const t=this._inputWrapper.layout;if(e){this._input.parent=null;t.addWidget(this._inputPlaceholder)}else{this._inputPlaceholder.parent=null;t.addWidget(this._input)}this._inputHidden=e;if(this.syncCollapse){this.saveCollapseState()}this.handleInputHidden(e)}saveCollapseState(){const e=Object.assign({},this.model.metadata.get("jupyter"));if(this.inputHidden&&e.source_hidden===true||!this.inputHidden&&e.source_hidden===undefined){return}if(this.inputHidden){e.source_hidden=true}else{delete e.source_hidden}if(Object.keys(e).length===0){this.model.metadata.delete("jupyter")}else{this.model.metadata.set("jupyter",e)}}loadCollapseState(){const e=this.model.metadata.get("jupyter")||{};this.inputHidden=!!e.source_hidden}handleInputHidden(e){return}get syncCollapse(){return this._syncCollapse}set syncCollapse(e){if(this._syncCollapse===e){return}this._syncCollapse=e;if(e){this.loadCollapseState()}}get syncEditable(){return this._syncEditable}set syncEditable(e){if(this._syncEditable===e){return}this._syncEditable=e;if(e){this.loadEditableState()}}clone(){const e=this.constructor;return new e({model:this.model,contentFactory:this.contentFactory,placeholder:false})}dispose(){if(this.isDisposed){return}this._input=null;this._model=null;this._inputWrapper=null;this._inputPlaceholder=null;super.dispose()}onAfterAttach(e){this.update()}onActivateRequest(e){this.editor.focus()}onFitRequest(e){this.editor.refresh()}onUpdateRequest(e){if(!this._model){return}if(this.editor.getOption("readOnly")!==this._readOnly){this.editor.setOption("readOnly",this._readOnly);this.toggleClass(be,this._readOnly)}}onMetadataChanged(e,t){switch(t.key){case"jupyter":if(this.syncCollapse){this.loadCollapseState()}break;case"editable":if(this.syncEditable){this.loadEditableState()}break;default:break}}}(function(e){class t{constructor(e={}){this._editorFactory=e.editorFactory||I.defaultEditorFactory}get editorFactory(){return this._editorFactory}createCellHeader(){return new O}createCellFooter(){return new k}createInputPrompt(){return new F}createOutputPrompt(){return new B.OutputPrompt}createStdin(e){return new B.Stdin(e)}}e.ContentFactory=t;e.defaultContentFactory=new t})(We||(We={}));class Ve extends We{constructor(e){super(e);this._outputHidden=false;this._syncScrolled=false;this._savingMetadata=false;this.addClass(Oe);const t=this._rendermime=e.rendermime;const s=this.contentFactory;const n=this.model;if(!e.placeholder){const a=this._outputWrapper=new x.Panel;a.addClass(_e);const i=new w;i.addClass(xe);const o=this._output=new B.OutputArea({model:n.outputs,rendermime:t,contentFactory:s,maxNumberOutputs:e.maxNumberOutputs});o.addClass(ve);if(n.outputs.length===0){this.addClass(Ie)}o.outputLengthChanged.connect(this._outputLengthHandler,this);a.addWidget(i);a.addWidget(o);this.layout.insertWidget(2,new pe(this.node));this.layout.insertWidget(3,a);if(n.isDirty){this.addClass(Se)}this._outputPlaceholder=new oe((()=>{this.outputHidden=!this.outputHidden}))}n.stateChanged.connect(this.onStateChanged,this)}initializeState(){super.initializeState();this.loadScrolledState();this.setPrompt(`${this.model.executionCount||""}`);return this}get outputArea(){return this._output}get outputHidden(){return this._outputHidden}set outputHidden(e){if(this._outputHidden===e){return}const t=this._outputWrapper.layout;if(e){t.removeWidget(this._output);t.addWidget(this._outputPlaceholder);if(this.inputHidden&&!this._outputWrapper.isHidden){this._outputWrapper.hide()}}else{if(this._outputWrapper.isHidden){this._outputWrapper.show()}t.removeWidget(this._outputPlaceholder);t.addWidget(this._output)}this._outputHidden=e;if(this.syncCollapse){this.saveCollapseState()}}saveCollapseState(){this._savingMetadata=true;try{super.saveCollapseState();const e=this.model.metadata;const t=this.model.metadata.get("collapsed");if(this.outputHidden&&t===true||!this.outputHidden&&t===undefined){return}if(this.outputHidden){e.set("collapsed",true)}else{e.delete("collapsed")}}finally{this._savingMetadata=false}}loadCollapseState(){super.loadCollapseState();this.outputHidden=!!this.model.metadata.get("collapsed")}get outputsScrolled(){return this._outputsScrolled}set outputsScrolled(e){this.toggleClass("jp-mod-outputsScrolled",e);this._outputsScrolled=e;if(this.syncScrolled){this.saveScrolledState()}}saveScrolledState(){const{metadata:e}=this.model;const t=e.get("scrolled");if(this.outputsScrolled&&t===true||!this.outputsScrolled&&t===undefined){return}if(this.outputsScrolled){e.set("scrolled",true)}else{e.delete("scrolled")}}loadScrolledState(){const e=this.model.metadata;if(e.get("scrolled")==="auto"){this.outputsScrolled=false}else{this.outputsScrolled=!!e.get("scrolled")}}get syncScrolled(){return this._syncScrolled}set syncScrolled(e){if(this._syncScrolled===e){return}this._syncScrolled=e;if(e){this.loadScrolledState()}}handleInputHidden(e){if(!e&&this._outputWrapper.isHidden){this._outputWrapper.show()}else if(e&&!this._outputWrapper.isHidden&&this._outputHidden){this._outputWrapper.hide()}}clone(){const e=this.constructor;return new e({model:this.model,contentFactory:this.contentFactory,rendermime:this._rendermime,placeholder:false})}cloneOutputArea(){return new B.SimplifiedOutputArea({model:this.model.outputs,contentFactory:this.contentFactory,rendermime:this._rendermime})}dispose(){if(this.isDisposed){return}this._output.outputLengthChanged.disconnect(this._outputLengthHandler,this);this._rendermime=null;this._output=null;this._outputWrapper=null;this._outputPlaceholder=null;super.dispose()}onStateChanged(e,t){switch(t.name){case"executionCount":this.setPrompt(`${e.executionCount||""}`);break;case"isDirty":if(e.isDirty){this.addClass(Se)}else{this.removeClass(Se)}break;default:break}}onMetadataChanged(e,t){if(this._savingMetadata){return}switch(t.key){case"scrolled":if(this.syncScrolled){this.loadScrolledState()}break;case"collapsed":if(this.syncCollapse){this.loadCollapseState()}break;default:break}super.onMetadataChanged(e,t)}_outputLengthHandler(e,t){const s=t===0?true:false;this.toggleClass(Ie,s)}}(function(e){async function t(e,t,s){var n;const a=e.model;const i=a.value.text;if(!i.trim()||!((n=t.session)===null||n===void 0?void 0:n.kernel)){a.clearExecution();return}const o={cellId:a.id};s=Object.assign(Object.assign(Object.assign({},a.metadata.toJSON()),s),o);const{recordTiming:r}=s;a.clearExecution();e.outputHidden=false;e.setPrompt("*");a.trusted=true;let d;try{const n=B.OutputArea.execute(i,e.outputArea,t,s);if(r){const t=e=>{let t;switch(e.header.msg_type){case"status":t=`status.${e.content.execution_state}`;break;case"execute_input":t="execute_input";break;default:return true}const s=e.header.date||(new Date).toISOString();const n=Object.assign({},a.metadata.get("execution"));n[`iopub.${t}`]=s;a.metadata.set("execution",n);return true};e.outputArea.future.registerMessageHook(t)}else{a.metadata.delete("execution")}d=e.outputArea.future;const o=await n;a.executionCount=o.content.execution_count;if(r){const e=Object.assign({},a.metadata.get("execution"));const t=o.metadata.started;if(t){e["shell.execute_reply.started"]=t}const s=o.header.date;e["shell.execute_reply"]=s||(new Date).toISOString();a.metadata.set("execution",e)}return o}catch(l){if(d&&!e.isDisposed&&e.outputArea.future===d){e.setPrompt("")}throw l}}e.execute=t})(Ve||(Ve={}));class Be extends We{handleEvent(e){switch(e.type){case"paste":this._evtPaste(e);break;case"dragenter":e.preventDefault();break;case"dragover":e.preventDefault();break;case"drop":this._evtNativeDrop(e);break;case"lm-dragover":this._evtDragOver(e);break;case"lm-drop":this._evtDrop(e);break;default:break}}onAfterAttach(e){super.onAfterAttach(e);const t=this.node;t.addEventListener("lm-dragover",this);t.addEventListener("lm-drop",this);t.addEventListener("dragenter",this);t.addEventListener("dragover",this);t.addEventListener("drop",this);t.addEventListener("paste",this)}onBeforeDetach(e){const t=this.node;t.removeEventListener("drop",this);t.removeEventListener("dragover",this);t.removeEventListener("dragenter",this);t.removeEventListener("paste",this);t.removeEventListener("lm-dragover",this);t.removeEventListener("lm-drop",this)}_evtDragOver(e){const t=(0,n.some)(ue.imageRendererFactory.mimeTypes,(t=>{if(!e.mimeData.hasData(Pe)){return false}const s=e.mimeData.getData(Pe);return s.model.mimetype===t}));if(!t){return}e.preventDefault();e.stopPropagation();e.dropAction=e.proposedAction}_evtPaste(e){if(e.clipboardData){const t=e.clipboardData.items;for(let s=0;s<t.length;s++){if(t[s].type==="text/plain"){if(s<t.length-1&&t[s+1].kind==="file"){continue}t[s].getAsString((e=>{var t,s;(s=(t=this.editor).replaceSelection)===null||s===void 0?void 0:s.call(t,e)}))}this._attachFiles(e.clipboardData.items)}}e.preventDefault()}_evtNativeDrop(e){if(e.dataTransfer){this._attachFiles(e.dataTransfer.items)}e.preventDefault()}_evtDrop(e){const t=(0,n.toArray)((0,n.filter)(e.mimeData.types(),(t=>{if(t===Pe){const t=e.mimeData.getData(Pe);return ue.imageRendererFactory.mimeTypes.indexOf(t.model.mimetype)!==-1}return ue.imageRendererFactory.mimeTypes.indexOf(t)!==-1})));if(t.length===0){return}e.preventDefault();e.stopPropagation();if(e.proposedAction==="none"){e.dropAction="none";return}e.dropAction="copy";for(const s of t){if(s===Pe){const{model:t,withContent:s}=e.mimeData.getData(Pe);if(t.type==="file"){const e=this._generateURI(t.name);this.updateCellSourceWithAttachment(t.name,e);void s().then((t=>{this.model.attachments.set(e,{[t.mimetype]:t.content})}))}}else{const t=this._generateURI();this.model.attachments.set(t,{[s]:e.mimeData.getData(s)});this.updateCellSourceWithAttachment(t,t)}}}_attachFiles(e){for(let t=0;t<e.length;t++){const s=e[t];if(s.kind==="file"){const e=s.getAsFile();if(e){this._attachFile(e)}}}}_attachFile(e){const t=new FileReader;t.onload=s=>{const{href:n,protocol:a}=le.URLExt.parse(t.result);if(a!=="data:"){return}const i=/([\w+\/\+]+)?(?:;(charset=[\w\d-]*|base64))?,(.*)/;const o=i.exec(n);if(!o||o.length!==4){return}const r=o[1];const d=o[3];const l={[r]:d};const u=this._generateURI(e.name);if(r.startsWith("image/")){this.model.attachments.set(u,l);this.updateCellSourceWithAttachment(e.name,u)}};t.onerror=t=>{console.error(`Failed to attach ${e.name}`+t)};t.readAsDataURL(e)}_generateURI(e=""){const t=e.lastIndexOf(".");return t!==-1?H.UUID.uuid4().concat(e.substring(t)):H.UUID.uuid4()}}class Le extends Be{constructor(e){var t,s;super(e);this._toggleCollapsedSignal=new P.Signal(this);this._renderer=null;this._rendered=true;this._prevText="";this._ready=new H.PromiseDelegate;this.addClass(ke);this._rendermime=e.rendermime.clone({resolver:new W.AttachmentsResolver({parent:(t=e.rendermime.resolver)!==null&&t!==void 0?t:undefined,model:this.model.attachments})});this.editor.setOption("handlePaste",false);this._headingCollapsed=(s=this.model.metadata.get(De))!==null&&s!==void 0?s:false;this._monitor=new le.ActivityMonitor({signal:this.model.contentChanged,timeout:He});this._monitor.activityStopped.connect((()=>{if(this._rendered){this.update()}}),this);void this._updateRenderedInput().then((()=>{this._ready.resolve(void 0)}));this.renderCollapseButtons(this._renderer);this.renderInput(this._renderer)}get ready(){return this._ready.promise}get headingInfo(){let e=this.model.value.text;const t=de().lexer(e);let s;for(s of t){if(s.type==="heading"){return{text:s.text,level:s.depth}}else if(s.type==="html"){let e=s.raw.match(/<h([1-6])(.*?)>(.*?)<\/h\1>/);if(e===null||e===void 0?void 0:e[3]){return{text:e[3],level:parseInt(e[1])}}return{text:"",level:-1}}}return{text:"",level:-1}}get headingCollapsed(){return this._headingCollapsed}set headingCollapsed(e){this._headingCollapsed=e;if(e){this.model.metadata.set(De,e)}else if(this.model.metadata.has(De)){this.model.metadata.delete(De)}const t=this.inputArea.promptNode.getElementsByClassName(Ee)[0];if(t){t.setAttribute("style",`background:\n      ${e?"var(--jp-icon-caret-right)":"var(--jp-icon-caret-down)"} no-repeat center`)}this.renderCollapseButtons(this._renderer)}get numberChildNodes(){return this._numberChildNodes}set numberChildNodes(e){this._numberChildNodes=e;this.renderCollapseButtons(this._renderer)}get toggleCollapsedSignal(){return this._toggleCollapsedSignal}get rendered(){return this._rendered}set rendered(e){if(e===this._rendered){return}this._rendered=e;this._handleRendered();if(!this._rendered){this.editor.refresh()}}maybeCreateCollapseButton(){if(this.headingInfo.level>0&&this.inputArea.promptNode.getElementsByClassName(Ee).length==0){let e=this.inputArea.promptNode.appendChild(document.createElement("button"));e.className=`bp3-button bp3-minimal jp-Button minimal ${Ee}`;e.style.background=`${this._headingCollapsed?"var(--jp-icon-caret-right)":"var(--jp-icon-caret-down)"} no-repeat center`;e.onclick=e=>{this.headingCollapsed=!this.headingCollapsed;this._toggleCollapsedSignal.emit(this._headingCollapsed)}}}maybeCreateOrUpdateExpandButton(){var e,t;const s=this.node.getElementsByClassName(Me);if(this.headingCollapsed&&s.length===0&&this._numberChildNodes>0){const e=document.createElement("button");e.className=`bp3-button bp3-minimal jp-Button ${Me}`;Q.addIcon.render(e);const t=document.createElement("div");t.nodeValue=`${this._numberChildNodes} cell${this._numberChildNodes>1?"s":""} hidden`;e.appendChild(t);e.onclick=()=>{this.headingCollapsed=false;this._toggleCollapsedSignal.emit(this._headingCollapsed)};this.node.appendChild(e)}else if(((t=(e=s===null||s===void 0?void 0:s[0])===null||e===void 0?void 0:e.childNodes)===null||t===void 0?void 0:t.length)>1){if(this._headingCollapsed){s[0].childNodes[1].textContent=`${this._numberChildNodes} cell${this._numberChildNodes>1?"s":""} hidden`}else{for(const e of s){this.node.removeChild(e)}}}}renderCollapseButtons(e){this.node.classList.toggle(De,this._headingCollapsed);this.maybeCreateCollapseButton();this.maybeCreateOrUpdateExpandButton()}renderInput(e){this.addClass(Ae);this.renderCollapseButtons(e);this.inputArea.renderInput(e)}showEditor(){this.removeClass(Ae);this.inputArea.showEditor()}onUpdateRequest(e){this._handleRendered();super.onUpdateRequest(e)}updateCellSourceWithAttachment(e,t){var s,n;const a=`![${e}](attachment:${t!==null&&t!==void 0?t:e})`;(n=(s=this.editor).replaceSelection)===null||n===void 0?void 0:n.call(s,a)}_handleRendered(){if(!this._rendered){this.showEditor()}else{void this._updateRenderedInput();this.renderInput(this._renderer)}}_updateRenderedInput(){const e=this.model;const t=e&&e.value.text||Fe;if(t!==this._prevText){const e=new ue.MimeModel({data:{"text/markdown":t}});if(!this._renderer){this._renderer=this._rendermime.createRenderer("text/markdown");this._renderer.addClass(je)}this._prevText=t;return this._renderer.renderModel(e)}return Promise.resolve(void 0)}clone(){const e=this.constructor;return new e({model:this.model,contentFactory:this.contentFactory,rendermime:this._rendermime,placeholder:false})}}class Re extends We{constructor(e){super(e);this.addClass(Ne)}clone(){const e=this.constructor;return new e({model:this.model,contentFactory:this.contentFactory,placeholder:false})}}}}]);