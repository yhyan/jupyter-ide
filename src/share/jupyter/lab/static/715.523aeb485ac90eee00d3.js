(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[715],{20715:(e,t,s)=>{"use strict";s.r(t);s.d(t,{CodeMirrorSearchProvider:()=>o,FOUND_CLASSES:()=>d,GenericSearchProvider:()=>_,ISearchProviderRegistry:()=>oe,NotebookSearchProvider:()=>v,SearchInstance:()=>ie,SearchProviderRegistry:()=>ce,SearchState:()=>l});var r=s(26825);var n=s(78775);var i=s(1166);var a=s(75138);var c=s(26260);var h=s.n(c);class o{constructor(){this.isReadOnly=false;this.isSubProvider=false;this._matchState={};this._changed=new a.Signal(this)}getInitialQuery(e){const t=e.content.editor;const s=t.doc.getSelection();return s.search(/\r?\n|\r/g)===-1?s:""}async startQuery(e,t,s={}){if(!o.canSearchOn(t)){throw new Error("Cannot find Codemirror instance to search")}this._cm=t.content.editor;return this._startQuery(e)}async startQueryCodeMirror(e,t){this._cm=t;return this._startQuery(e,false)}refreshOverlay(){this._refreshOverlay()}async _startQuery(e,t=true){await this.endQuery(false);this._query=e;c.on(this._cm.doc,"change",this._onDocChanged.bind(this));if(t){this._refreshOverlay()}this._setInitialMatches(e);const s=this._parseMatchesFromState();if(s.length===0){return[]}if(!this.isSubProvider){const e=this._findNext(false);const t=e&&this._matchState[e.from.line][e.from.ch];this._currentMatch=t}return s}async endQuery(e=true){this._matchState={};this._currentMatch=null;if(e){this._cm.removeOverlay(this._overlay)}const t=this._cm.getCursor("from");const s=this._cm.getCursor("to");if(t!==s){this._cm.setSelection({start:this._toEditorPos(s),end:this._toEditorPos(t)})}c.off(this._cm.doc,"change",this._onDocChanged.bind(this))}async endSearch(){if(!this.isSubProvider){this._cm.focus()}return this.endQuery()}async highlightNext(){const e=this._findNext(false);if(!e){return}const t=this._matchState[e.from.line][e.from.ch];this._currentMatch=t;return t}async highlightPrevious(){const e=this._findNext(true);if(!e){return}const t=this._matchState[e.from.line][e.from.ch];this._currentMatch=t;return t}async replaceCurrentMatch(e){let t=false;if(this._currentMatchIsSelected()){const s=this._cm.getSearchCursor(this._query,this._cm.getCursor("from"),!this._query.ignoreCase);if(!s.findNext()){return t}t=true;s.replace(e)}await this.highlightNext();return t}async replaceAllMatches(e){let t=false;return new Promise(((s,r)=>{this._cm.operation((()=>{const r=this._cm.getSearchCursor(this._query,undefined,!this._query.ignoreCase);while(r.findNext()){t=true;r.replace(e)}this._matchState={};this._currentMatch=null;s(t)}))}))}static canSearchOn(e){return e instanceof r.MainAreaWidget&&e.content instanceof i.FileEditor&&e.content.editor instanceof n.CodeMirrorEditor}get matches(){return this._parseMatchesFromState()}get currentMatch(){return this._currentMatch}get changed(){return this._changed}get currentMatchIndex(){if(!this._currentMatch){return null}return this._currentMatch.index}clearSelection(){return undefined}get editor(){return this._cm}_onDocChanged(e,t){var s,r;if(t.text.length>1||((r=(s=t.removed)===null||s===void 0?void 0:s.length)!==null&&r!==void 0?r:0)>1){this._setInitialMatches(this._query);this._changed.emit(undefined)}}_refreshOverlay(){this._cm.operation((()=>{this._cm.removeOverlay(this._overlay);this._overlay=this._getSearchOverlay();this._cm.addOverlay(this._overlay);this._changed.emit(undefined)}))}_setInitialMatches(e){this._matchState={};const t=c.Pos(this._cm.doc.firstLine(),0);const s=c.Pos(this._cm.doc.lastLine());const r=this._cm.doc.getRange(t,s);const n=r.split("\n");const i=0;n.forEach(((t,s)=>{e.lastIndex=0;let r=e.exec(t);while(r){const n=r.index;const a={text:r[0],line:s,column:n,fragment:t,index:i};if(!this._matchState[s]){this._matchState[s]={}}this._matchState[s][n]=a;r=e.exec(t)}}))}_getSearchOverlay(){return{token:e=>{const t=e.pos;this._query.lastIndex=t;const s=e.string;const r=this._query.exec(s);const n=e.lineOracle.line;if(e.start===t&&t===0&&!!this._matchState[n]){this._matchState[n]={}}if(r&&r.index===t){const i=r[0].length;const a={text:s.substr(t,i),line:n,column:t,fragment:s,index:0};if(!this._matchState[n]){this._matchState[n]={}}this._matchState[n][t]=a;e.pos+=i||1;if(e.eol()){this._changed.emit(undefined)}return"searching"}else if(r){e.pos=r.index}else{this._changed.emit(undefined);e.skipToEnd()}}}}_findNext(e){return this._cm.operation((()=>{const t=this._query.ignoreCase;const s=e?"anchor":"head";const r=this._cm.getCursor(s);const n=this._toEditorPos(r);let i=this._cm.getSearchCursor(this._query,r,!t);if(!i.find(e)){if(this.isSubProvider){this._cm.setCursorPosition(n,{scroll:false});this._currentMatch=null;return null}const s=e?c.Pos(this._cm.lastLine()):c.Pos(this._cm.firstLine(),0);i=this._cm.getSearchCursor(this._query,s,!t);if(!i.find(e)){return null}}const a=i.from();const h=i.to();const o={start:{line:a.line,column:a.ch},end:{line:h.line,column:h.ch}};this._cm.setSelection(o);this._cm.scrollIntoView({from:a,to:h},100);return{from:a,to:h}}))}_parseMatchesFromState(){let e=0;const t=Object.keys(this._matchState).reduce(((t,s)=>{const r=parseInt(s,10);const n=this._matchState[r];Object.keys(n).forEach((s=>{const r=parseInt(s,10);const i=n[r];i.index=e;e+=1;t.push(i)}));return t}),[]);return t}_toEditorPos(e){return{line:e.line,column:e.ch}}_currentMatchIsSelected(){if(!this._currentMatch){return false}const e=this._cm.getSelection();const t=e.end.column-e.start.column;const s=e.start.line===e.end.line;return this._currentMatch.line===e.start.line&&this._currentMatch.column===e.start.column&&this._currentMatch.text.length===t&&s}}class l{}var u=s(61389);const d=["cm-string","cm-overlay","cm-searching"];const p=["CodeMirror-selectedtext"];class _{constructor(){this.isReadOnly=true;this.isSubProvider=false;this._matches=[];this._mutationObserver=new MutationObserver(this._onWidgetChanged.bind(this));this._changed=new a.Signal(this)}getInitialQuery(e){return""}async startQuery(e,t,s={}){const r=this;await this.endQuery(false);this._widget=t;this._query=e;this._mutationObserver.disconnect();const n=[];const i=document.createTreeWalker(this._widget.node,NodeFilter.SHOW_TEXT,{acceptNode:e=>{let t=e.parentElement;while(t!==this._widget.node){if(t.nodeName in _.UNSUPPORTED_ELEMENTS){return NodeFilter.FILTER_REJECT}t=t.parentElement}return r._query.test(e.textContent)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}},false);const a=[];const c=[];let h=i.nextNode();while(h){a.push(h);c.push(h.parentElement.cloneNode(true));h=i.nextNode()}const o=this._query.flags.indexOf("g")===-1?e.flags+"g":e.flags;a.forEach(((t,s)=>{const r=new RegExp(e.source,o);const i=[];let a=r.exec(t.textContent);while(a){i.push({start:a.index,end:a.index+a[0].length,text:a[0]});a=r.exec(t.textContent)}const h=c[s];const l=t.textContent.length;let u=null;const p=[];for(let e=i.length-1;e>=0;--e){const{start:s,end:r,text:n}=i[e];const a=document.createElement("span");a.classList.add(...d);a.textContent=n;t.textContent=`${t.textContent.slice(0,s)}${t.textContent.slice(r)}`;if((t===null||t===void 0?void 0:t.nodeType)==Node.TEXT_NODE){const e=t.splitText(s);t.parentNode.insertBefore(a,e)}else if(s===0){t.parentNode.prepend(a)}else if(r===l){t.parentNode.append(a)}else if(u&&r===i[e+1].start){t.parentNode.insertBefore(a,u)}u=a;p.unshift({text:n,fragment:"",line:0,column:0,index:-1,matchesIndex:-1,indexInOriginal:e,spanElement:a,originalNode:h})}n.push(...p)}));n.forEach(((e,t)=>{e.index=t;e.matchesIndex=t}));if(!this.isSubProvider&&n.length>0){this._currentMatch=n[0]}this._mutationObserver.observe(this._widget.node,{attributes:false,characterData:true,childList:true,subtree:true});this._matches=n;return this._matches}refreshOverlay(){}async endQuery(e=true){this._matches.forEach((e=>{if(e.indexInOriginal!==0){return}e.spanElement.parentElement.replaceWith(e.originalNode)}));this._matches=[];this._currentMatch=null;this._mutationObserver.disconnect()}async endSearch(){return this.endQuery()}async highlightNext(){return this._highlightNext(false)}async highlightPrevious(){return this._highlightNext(true)}_highlightNext(e){if(this._matches.length===0){return undefined}if(!this._currentMatch){this._currentMatch=e?this._matches[this.matches.length-1]:this._matches[0]}else{this._currentMatch.spanElement.classList.remove(...p);let t=e?this._currentMatch.matchesIndex-1:this._currentMatch.matchesIndex+1;if(this.isSubProvider){if(t<0||t>=this._matches.length){this._currentMatch=null;return undefined}}t=(t+this._matches.length)%this._matches.length;this._currentMatch=this._matches[t]}if(this._currentMatch){this._currentMatch.spanElement.classList.add(...p);if(!g(this._currentMatch.spanElement)){this._currentMatch.spanElement.scrollIntoView(e)}this._currentMatch.spanElement.focus()}return this._currentMatch}async replaceCurrentMatch(e){return Promise.resolve(false)}async replaceAllMatches(e){return Promise.resolve(false)}static canSearchOn(e){return e instanceof u.Widget}get matches(){return this._matches?this._matches.map((e=>Object.assign({},e))):this._matches}get changed(){return this._changed}get currentMatchIndex(){if(!this._currentMatch){return null}return this._currentMatch.index}get currentMatch(){return this._currentMatch}clearSelection(){return}async _onWidgetChanged(e,t){await this.startQuery(this._query,this._widget);this._changed.emit(undefined)}}_.UNSUPPORTED_ELEMENTS={BASE:true,HEAD:true,LINK:true,META:true,STYLE:true,TITLE:true,BODY:true,AREA:true,AUDIO:true,IMG:true,MAP:true,TRACK:true,VIDEO:true,APPLET:true,EMBED:true,IFRAME:true,NOEMBED:true,OBJECT:true,PARAM:true,PICTURE:true,SOURCE:true,CANVAS:true,NOSCRIPT:true,SCRIPT:true,SVG:true};function g(e){const t=e.getBoundingClientRect();return t.top>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.left>=0&&t.right<=(window.innerWidth||document.documentElement.clientWidth)}var f=s(6014);var m=s(3860);var S=s(62867);class v{constructor(){this.isReadOnly=false;this.hasOutputs=true;this._searchProviders=[];this._unRenderedMarkdownCells=[];this._cellsWithMatches=[];this._changed=new a.Signal(this)}getInitialQuery(e){var t;const s=e.content.activeCell;const r=(t=s===null||s===void 0?void 0:s.editor)===null||t===void 0?void 0:t.doc.getSelection();return(r===null||r===void 0?void 0:r.search(/\r?\n|\r/g))===-1?r:""}async startQuery(e,t,s){this._searchTarget=t;let r=this._searchTarget.content.widgets;this._filters=!s||Object.entries(s).length===0?{output:true,selectedCells:false}:s;const n=r.filter((e=>this._searchTarget.content.isSelectedOrActive(e)));if(this._filters.selectedCells&&n.length>0){r=n}this._searchTarget.hide();let i=0;const a=[];for(const c of r){const t=c.editor;const s=new o;s.isSubProvider=true;let r=false;if(c instanceof f.MarkdownCell&&c.rendered){c.rendered=false;r=true}if(c.inputHidden){c.inputHidden=false}const n=await s.startQueryCodeMirror(e,t);if(c instanceof f.MarkdownCell){if(n.length!==0){this._unRenderedMarkdownCells.push(c)}else if(r){c.rendered=true}}if(n.length!==0){s.refreshOverlay();this._cellsWithMatches.push(c)}n.forEach((e=>{e.index=e.index+i}));i+=n.length;s.changed.connect(this._onSearchProviderChanged,this);a.concat(n);this._searchProviders.push({cell:c,provider:s});if(c instanceof f.CodeCell&&this._filters.output){const t=new _;t.isSubProvider=true;const s=await t.startQuery(e,c.outputArea);s.map((e=>{e.index=e.index+i}));i+=s.length;a.concat(s);t.changed.connect(this._onSearchProviderChanged,this);this._searchProviders.push({cell:c,provider:t})}}this._searchTarget.show();this._currentMatch=await this._stepNext(this._updatedCurrentProvider(false));this._refreshCurrentCellEditor();this._refreshCellsEditorsInBackground(this._cellsWithMatches);return a}_refreshCellsEditorsInBackground(e,t=5){let s=0;const r=()=>{for(let r=s+t;s<r&&s<e.length;s++){e[s].editor.refresh()}if(s<e.length){window.setTimeout(r,0)}};window.setTimeout(r,0)}_refreshCurrentCellEditor(){const e=this._searchTarget.content;e.activeCell.editor.refresh()}async endQuery(){this._searchTarget.hide();const e=[];this._searchProviders.forEach((({provider:t})=>{e.push(t.endQuery());t.changed.disconnect(this._onSearchProviderChanged,this)}));a.Signal.disconnectBetween(this._searchTarget.model.cells,this);this._searchProviders=[];this._currentProvider=null;this._unRenderedMarkdownCells.forEach((e=>{if(!e.isDisposed){e.rendered=true}}));this._unRenderedMarkdownCells=[];await Promise.all(e);this._searchTarget.show();this._refreshCurrentCellEditor();this._refreshCellsEditorsInBackground(this._cellsWithMatches.filter((e=>!(e instanceof f.MarkdownCell))));this._cellsWithMatches=[]}async endSearch(){this._searchTarget.hide();a.Signal.disconnectBetween(this._searchTarget.model.cells,this);const e=this._searchTarget.content.activeCellIndex;const t=[];this._searchProviders.forEach((({provider:e})=>{t.push(e.endSearch());e.changed.disconnect(this._onSearchProviderChanged,this)}));this._searchProviders=[];this._currentProvider=null;this._unRenderedMarkdownCells.forEach((e=>{e.rendered=true}));this._unRenderedMarkdownCells=[];this._searchTarget.content.activeCellIndex=e;this._searchTarget.content.mode="edit";this._currentMatch=null;await Promise.all(t);this._searchTarget.show();this._refreshCurrentCellEditor();this._searchTarget=null;this._refreshCellsEditorsInBackground(this._cellsWithMatches.filter((e=>!(e instanceof f.MarkdownCell))));this._cellsWithMatches=[]}async highlightNext(){this._currentMatch=await this._stepNext(this._updatedCurrentProvider(false));return this._currentMatch}async highlightPrevious(){this._currentMatch=await this._stepNext(this._updatedCurrentProvider(true),true);return this._currentMatch}async replaceCurrentMatch(e){const t=this._searchTarget.content;const s=t.activeCell.editor;let r=false;if(this._currentMatchIsSelected(s)){const{provider:t}=this._currentProvider;r=await t.replaceCurrentMatch(e);if(r){this._currentMatch=t.currentMatch;if(this._currentMatch){return r}}}await this.highlightNext();return r}async replaceAllMatches(e){let t=false;for(const s in this._searchProviders){const{provider:r}=this._searchProviders[s];const n=await r.replaceAllMatches(e);t=n?true:t}this._currentMatch=null;return t}static canSearchOn(e){return e instanceof m.NotebookPanel}get matches(){return[].concat(...this._getMatchesFromCells())}get changed(){return this._changed}get currentMatchIndex(){if(!this._currentMatch){return null}return this._currentMatch.index}_updatedCurrentProvider(e){if(this._currentProvider&&this._currentProvider.cell===this._searchTarget.content.activeCell){return this._currentProvider}let t;if(!this._currentProvider){const s=e?S.ArrayExt.findLastValue:S.ArrayExt.findFirstValue;t=s(this._searchProviders,(e=>this._searchTarget.content.activeCell===e.cell))}else{const s=S.ArrayExt.firstIndexOf(this._searchProviders,this._currentProvider);const r=((e?s-1:s+1)+this._searchProviders.length)%this._searchProviders.length;t=this._searchProviders[r]}this._currentProvider=t;return t}async _stepNext(e,t=false,s=0){const{provider:r}=e;const n=t?await r.highlightPrevious():await r.highlightNext();if(!n){const r=this._searchProviders.indexOf(e);const n=this._searchProviders.length;if(s===n){return undefined}const i=((t?r-1:r+1)+n)%n;const a=this._searchProviders[i];if(a.provider instanceof o){const e=a.provider.editor;const s=t?h().Pos(e.lastLine()):h().Pos(e.firstLine(),0);const r={line:s.line,column:s.ch};e.setCursorPosition(r,{scroll:false})}this._currentProvider=a;return this._stepNext(a,t,s+1)}const i=this._searchTarget.content;i.activeCellIndex=i.widgets.indexOf(e.cell);return n}_getMatchesFromCells(){let e=0;const t=[];this._searchProviders.forEach((({provider:s})=>{const r=s.matches;r.forEach((t=>{t.index=t.index+e}));e+=r.length;t.push(r)}));return t}_onSearchProviderChanged(){this._changed.emit(undefined)}_currentMatchIsSelected(e){if(!this._currentMatch){return false}const t=e.getSelection();const s=t.end.column-t.start.column;const r=t.start.line===t.end.line;return this._currentMatch.line===t.start.line&&this._currentMatch.column===t.start.column&&this._currentMatch.text.length===s&&r}}var y=s(1612);var x=s(92481);var C=s(87598);var E=s(2411);const M="jp-DocumentSearch-overlay";const w="jp-DocumentSearch-overlay-row";const P="jp-DocumentSearch-input";const I="jp-DocumentSearch-input-wrapper";const b="jp-DocumentSearch-input-button-off";const T="jp-DocumentSearch-input-button-on";const N="jp-DocumentSearch-index-counter";const R="jp-DocumentSearch-up-down-wrapper";const O="jp-DocumentSearch-up-down-button";const D="jp-DocumentSearch-ellipses-button";const k="jp-DocumentSearch-ellipses-button-enabled";const j="jp-DocumentSearch-regex-error";const F="jp-DocumentSearch-search-options";const A="jp-DocumentSearch-search-options-disabled";const Q="jp-DocumentSearch-document-loading";const W="jp-DocumentSearch-replace-entry";const q="jp-DocumentSearch-replace-button";const L="jp-DocumentSearch-replace-button-wrapper";const B="jp-DocumentSearch-replace-wrapper-class";const H="jp-DocumentSearch-replace-toggle";const $="jp-DocumentSearch-focused-input";const U="jp-DocumentSearch-toggle-wrapper";const K="jp-DocumentSearch-toggle-placeholder";const V="jp-DocumentSearch-button-content";const G="jp-DocumentSearch-button-wrapper";const J="jp-DocumentSearch-spacer";class X extends E.Component{constructor(e){super(e);this.translator=e.translator||y.nullTranslator;this._trans=this.translator.load("jupyterlab");this.searchInputRef=E.createRef()}focusInput(){var e;(e=this.searchInputRef.current)===null||e===void 0?void 0:e.select()}componentDidUpdate(){if(this.props.forceFocus){this.focusInput()}}render(){const e=(0,x.classes)(this.props.caseSensitive?T:b,V);const t=(0,x.classes)(this.props.useRegex?T:b,V);const s=`${I} ${this.props.inputFocused?$:""}`;return E.createElement("div",{className:s},E.createElement("input",{placeholder:this.props.searchText?undefined:this._trans.__("Find"),className:P,value:this.props.searchText,onChange:e=>this.props.onChange(e),onKeyDown:e=>this.props.onKeydown(e),tabIndex:0,onFocus:e=>this.props.onInputFocus(),onBlur:e=>this.props.onInputBlur(),ref:this.searchInputRef}),E.createElement("button",{className:G,onClick:()=>this.props.onCaseSensitiveToggled(),tabIndex:0},E.createElement(x.caseSensitiveIcon.react,{className:e,tag:"span"})),E.createElement("button",{className:G,onClick:()=>this.props.onRegexToggled(),tabIndex:0},E.createElement(x.regexIcon.react,{className:t,tag:"span"})))}}class Y extends E.Component{constructor(e){super(e);this._trans=(e.translator||y.nullTranslator).load("jupyterlab");this.replaceInputRef=E.createRef()}render(){return E.createElement("div",{className:B},E.createElement("input",{placeholder:this.props.replaceText?undefined:this._trans.__("Replace"),className:W,value:this.props.replaceText,onKeyDown:e=>this.props.onReplaceKeydown(e),onChange:e=>this.props.onChange(e),tabIndex:0,ref:this.replaceInputRef}),E.createElement("button",{className:L,onClick:()=>this.props.onReplaceCurrent(),tabIndex:0},E.createElement("span",{className:`${q} ${V}`,tabIndex:0},this._trans.__("Replace"))),E.createElement("button",{className:L,tabIndex:0,onClick:()=>this.props.onReplaceAll()},E.createElement("span",{className:`${q} ${V}`,tabIndex:-1},this._trans.__("Replace All"))))}}function z(e){return E.createElement("div",{className:R},E.createElement("button",{className:G,onClick:()=>e.onHighlightPrevious(),tabIndex:0},E.createElement(x.caretUpEmptyThinIcon.react,{className:(0,x.classes)(O,V),tag:"span"})),E.createElement("button",{className:G,onClick:()=>e.onHighlightNext(),tabIndex:0},E.createElement(x.caretDownEmptyThinIcon.react,{className:(0,x.classes)(O,V),tag:"span"})))}function Z(e){return E.createElement("div",{className:N},e.totalMatches===0?"-/-":`${e.currentIndex===null?"-":e.currentIndex+1}/${e.totalMatches}`)}class ee extends E.Component{render(){let e=`${D} ${V}`;if(this.props.enabled){e=`${e} ${k}`}return E.createElement("button",{className:G,onClick:()=>this.props.toggleEnabled(),tabIndex:0},E.createElement(x.ellipsesIcon.react,{className:e,tag:"span",height:"20px",width:"20px"}))}}class te extends E.Component{render(){return E.createElement("label",{className:F},E.createElement("div",null,E.createElement("span",{className:this.props.canToggleOutput?"":A},this.props.trans.__("Search Cell Outputs")),E.createElement("input",{type:"checkbox",disabled:!this.props.canToggleOutput,checked:this.props.searchOutput,onChange:this.props.toggleOutput})),E.createElement("div",null,E.createElement("span",{className:this.props.canToggleSelectedCells?"":A},this.props.trans.__("Search Selected Cell(s)")),E.createElement("input",{type:"checkbox",disabled:!this.props.canToggleSelectedCells,checked:this.props.searchSelectedCells,onChange:this.props.toggleSelectedCells})))}}class se extends E.Component{constructor(e){super(e);this._debouncedStartSearch=new C.Debouncer((()=>{this._executeSearch(true,this.state.searchText)}),500);this.translator=e.translator||y.nullTranslator;this.state=e.overlayState;this.replaceEntryRef=E.createRef();this._toggleSearchOutput=this._toggleSearchOutput.bind(this);this._toggleSearchSelectedCells=this._toggleSearchSelectedCells.bind(this)}componentDidMount(){if(this.state.searchText){this._executeSearch(true,this.state.searchText)}}_onSearchChange(e){const t=e.target.value;this.setState({searchText:t});void this._debouncedStartSearch.invoke()}_onReplaceChange(e){this.setState({replaceText:e.target.value})}_onSearchKeydown(e){if(e.keyCode===13){e.preventDefault();e.stopPropagation();this._executeSearch(!e.shiftKey)}else if(e.keyCode===27){e.preventDefault();e.stopPropagation();this._onClose()}}_onReplaceKeydown(e){if(e.keyCode===13){e.preventDefault();e.stopPropagation();this.props.onReplaceCurrent(this.state.replaceText)}}_executeSearch(e,t,s=false){let r;const n=t?t:this.state.searchText;try{r=ne.parseQuery(n,this.props.overlayState.caseSensitive,this.props.overlayState.useRegex);this.setState({errorMessage:""})}catch(i){this.setState({errorMessage:i.message});return}if(ne.regexEqual(this.props.overlayState.query,r)&&!s){if(e){this.props.onHighlightNext()}else{this.props.onHighlightPrevious()}return}this.props.onStartQuery(r,this.state.filters)}_onClose(){this.props.onEndSearch();this._debouncedStartSearch.dispose()}_onReplaceToggled(){this.setState({replaceEntryShown:!this.state.replaceEntryShown})}_onSearchInputFocus(){if(!this.state.searchInputFocused){this.setState({searchInputFocused:true})}}_onSearchInputBlur(){if(this.state.searchInputFocused){this.setState({searchInputFocused:false})}}_toggleSearchOutput(){this.setState((e=>Object.assign(Object.assign({},e),{filters:Object.assign(Object.assign({},e.filters),{output:!e.filters.output})})),(()=>this._executeSearch(true,undefined,true)))}_toggleSearchSelectedCells(){this.setState((e=>Object.assign(Object.assign({},e),{filters:Object.assign(Object.assign({},e.filters),{selectedCells:!e.filters.selectedCells})})),(()=>this._executeSearch(true,undefined,true)))}_toggleFiltersOpen(){this.setState((e=>({filtersOpen:!e.filtersOpen})))}render(){const e=!this.props.isReadOnly&&this.state.replaceEntryShown;const t=this.props.hasOutputs;const s=t?E.createElement(ee,{enabled:this.state.filtersOpen,toggleEnabled:()=>this._toggleFiltersOpen()}):null;const r=t?E.createElement(te,{key:"filter",canToggleOutput:!e,canToggleSelectedCells:true,searchOutput:this.state.filters.output,searchSelectedCells:this.state.filters.selectedCells,toggleOutput:this._toggleSearchOutput,toggleSelectedCells:this._toggleSearchSelectedCells,trans:this.translator.load("jupyterlab")}):null;const n=this.state.replaceEntryShown?x.caretDownIcon:x.caretRightIcon;return[E.createElement("div",{className:w,key:0},this.props.isReadOnly?E.createElement("div",{className:K}):E.createElement("button",{className:U,onClick:()=>this._onReplaceToggled(),tabIndex:0},E.createElement(n.react,{className:`${H} ${V}`,tag:"span",elementPosition:"center",height:"20px",width:"20px"})),E.createElement(X,{useRegex:this.props.overlayState.useRegex,caseSensitive:this.props.overlayState.caseSensitive,onCaseSensitiveToggled:()=>{this.props.onCaseSensitiveToggled();this._executeSearch(true)},onRegexToggled:()=>{this.props.onRegexToggled();this._executeSearch(true)},onKeydown:e=>this._onSearchKeydown(e),onChange:e=>this._onSearchChange(e),onInputFocus:this._onSearchInputFocus.bind(this),onInputBlur:this._onSearchInputBlur.bind(this),inputFocused:this.state.searchInputFocused,searchText:this.state.searchText,forceFocus:this.props.overlayState.forceFocus,translator:this.translator}),E.createElement(Z,{currentIndex:this.props.overlayState.currentIndex,totalMatches:this.props.overlayState.totalMatches}),E.createElement(z,{onHighlightPrevious:()=>this._executeSearch(false),onHighlightNext:()=>this._executeSearch(true)}),e?null:s,E.createElement("button",{className:G,onClick:()=>this._onClose(),tabIndex:0},E.createElement(x.closeIcon.react,{className:"jp-icon-hover",elementPosition:"center",height:"16px",width:"16px"}))),E.createElement("div",{className:w,key:1},e?E.createElement(E.Fragment,null,E.createElement(Y,{onReplaceKeydown:e=>this._onReplaceKeydown(e),onChange:e=>this._onReplaceChange(e),onReplaceCurrent:()=>this.props.onReplaceCurrent(this.state.replaceText),onReplaceAll:()=>this.props.onReplaceAll(this.state.replaceText),replaceText:this.state.replaceText,ref:this.replaceEntryRef,translator:this.translator}),E.createElement("div",{className:J}),s):null),this.state.filtersOpen?r:null,E.createElement("div",{className:j,hidden:!!this.state.errorMessage&&this.state.errorMessage.length===0,key:3},this.state.errorMessage),E.createElement("div",{className:Q,key:4},"This document is still loading. Only loaded content will appear in search results until the entire document loads.")]}}function re(e){const{widgetChanged:t,overlayState:s,onCaseSensitiveToggled:n,onRegexToggled:i,onHighlightNext:a,onHighlightPrevious:c,onStartQuery:h,onReplaceCurrent:o,onReplaceAll:l,onEndSearch:u,isReadOnly:d,hasOutputs:p,translator:_}=e;const g=r.ReactWidget.create(E.createElement(r.UseSignal,{signal:t,initialArgs:s},((e,t)=>E.createElement(se,{onCaseSensitiveToggled:n,onRegexToggled:i,onHighlightNext:a,onHighlightPrevious:c,onStartQuery:h,onEndSearch:u,onReplaceCurrent:o,onReplaceAll:l,overlayState:t,isReadOnly:d,hasOutputs:p,translator:_}))));g.addClass(M);return g}var ne;(function(e){function t(e,t,s){const r=t?"g":"gi";const n=s?e:e.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&");let i;i=new RegExp(n,r);if(i.test("")){i=/x^/}return i}e.parseQuery=t;function s(e,t){if(!e||!t){return false}return e.source===t.source&&e.global===t.global&&e.ignoreCase===t.ignoreCase&&e.multiline===t.multiline}e.regexEqual=s})(ne||(ne={}));class ie{constructor(e,t,s){this._displayState={currentIndex:0,totalMatches:0,caseSensitive:false,useRegex:false,searchText:"",query:null,errorMessage:"",searchInputFocused:true,replaceInputFocused:false,forceFocus:true,replaceText:"",replaceEntryShown:false,filters:{output:true,selectedCells:false},filtersOpen:false};this._displayUpdateSignal=new a.Signal(this);this._isDisposed=false;this._disposed=new a.Signal(this);this.translator=s||y.nullTranslator;this._widget=e;this._activeProvider=t;const n=this._activeProvider.getInitialQuery(this._widget);this._displayState.searchText=n||"";this._searchWidget=re({widgetChanged:this._displayUpdateSignal,overlayState:this._displayState,onCaseSensitiveToggled:this._onCaseSensitiveToggled.bind(this),onRegexToggled:this._onRegexToggled.bind(this),onHighlightNext:this._highlightNext.bind(this),onHighlightPrevious:this._highlightPrevious.bind(this),onStartQuery:this._startQuery.bind(this),onReplaceCurrent:this._replaceCurrent.bind(this),onReplaceAll:this._replaceAll.bind(this),onEndSearch:this.dispose.bind(this),isReadOnly:this._activeProvider.isReadOnly,hasOutputs:this._activeProvider.hasOutputs||false,translator:this.translator});this._widget.disposed.connect((()=>{this.dispose()}));this._searchWidget.disposed.connect((()=>{this._widget.activate();this.dispose()}));if(this._widget instanceof r.MainAreaWidget){this._searchWidget.node.style.top=`${this._widget.toolbar.node.clientHeight}px`}if(this._widget instanceof m.NotebookPanel){this._widget.content.activeCellChanged.connect((()=>{if(this._displayState.query&&this._displayState.filters.selectedCells){void this._startQuery(this._displayState.query,this._displayState.filters)}}))}this._displaySearchWidget()}get searchWidget(){return this._searchWidget}get provider(){return this._activeProvider}focusInput(){this._displayState.forceFocus=true;this._displayState.searchInputFocused=true;this._displayUpdateSignal.emit(this._displayState);this._displayState.forceFocus=false}showReplace(){this._displayState.replaceEntryShown=true}updateIndices(){this._displayState.totalMatches=this._activeProvider.matches.length;this._displayState.currentIndex=this._activeProvider.currentMatchIndex;this._updateDisplay()}_updateDisplay(){this._displayState.forceFocus=false;this._displayUpdateSignal.emit(this._displayState)}async _startQuery(e,t){if(this._activeProvider&&this._displayState.query){await this._activeProvider.endQuery()}this._displayState.query=e;this._displayState.filters=t;await this._activeProvider.startQuery(e,this._widget,t);this.updateIndices();this._activeProvider.changed.connect(this.updateIndices,this)}async _replaceCurrent(e){if(this._activeProvider&&this._displayState.query){await this._activeProvider.replaceCurrentMatch(e);this.updateIndices()}}async _replaceAll(e){if(this._activeProvider&&this._displayState.query){await this._activeProvider.replaceAllMatches(e);this.updateIndices()}}dispose(){if(this.isDisposed){return}this._isDisposed=true;if(this._displayState.query){void this._activeProvider.endSearch()}this._searchWidget.dispose();this._disposed.emit(undefined);a.Signal.clearData(this)}get isDisposed(){return this._isDisposed}get disposed(){return this._disposed}_displaySearchWidget(){if(!this._searchWidget.isAttached){u.Widget.attach(this._searchWidget,this._widget.node)}}async _highlightNext(){if(!this._displayState.query){return}await this._activeProvider.highlightNext();this.updateIndices()}async _highlightPrevious(){if(!this._displayState.query){return}await this._activeProvider.highlightPrevious();this.updateIndices()}_onCaseSensitiveToggled(){this._displayState.caseSensitive=!this._displayState.caseSensitive;this._updateDisplay()}_onRegexToggled(){this._displayState.useRegex=!this._displayState.useRegex;this._updateDisplay()}}var ae=s(76487);class ce{constructor(){this._changed=new a.Signal(this);this._providerMap=new Map}register(e,t){this._providerMap.set(e,t);this._changed.emit();return new ae.DisposableDelegate((()=>{this._providerMap.delete(e);this._changed.emit()}))}getProviderForWidget(e){return this._findMatchingProvider(this._providerMap,e)}get changed(){return this._changed}_findMatchingProvider(e,t){for(const s of e.values()){if(s.canSearchOn(t)){return new s}}return undefined}}var he=s(9727);const oe=new he.Token("@jupyterlab/documentsearch:ISearchProviderRegistry")}}]);