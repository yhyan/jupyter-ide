(self["webpackChunk_jupyterlab_application_top"]=self["webpackChunk_jupyterlab_application_top"]||[]).push([[3547],{3547:(e,t,s)=>{"use strict";s.r(t);s.d(t,{CodeConsole:()=>S,ConsoleHistory:()=>l,ConsolePanel:()=>E,ForeignHandler:()=>i,IConsoleTracker:()=>j});var n=s(75138);const o="jp-CodeConsole-foreignCell";class i{constructor(e){this._enabled=false;this._isDisposed=false;this.sessionContext=e.sessionContext;this.sessionContext.iopubMessage.connect(this.onIOPubMessage,this);this._parent=e.parent}get enabled(){return this._enabled}set enabled(e){this._enabled=e}get parent(){return this._parent}get isDisposed(){return this._isDisposed}dispose(){if(this.isDisposed){return}this._isDisposed=true;n.Signal.clearData(this)}onIOPubMessage(e,t){var s;if(!this._enabled){return false}const n=(s=this.sessionContext.session)===null||s===void 0?void 0:s.kernel;if(!n){return false}const o=this._parent;const i=t.parent_header.session;if(i===n.clientId){return false}const l=t.header.msg_type;const r=t.parent_header;const a=r.msg_id;let c;switch(l){case"execute_input":{const e=t;c=this._newCell(a);const s=c.model;s.executionCount=e.content.execution_count;s.value.text=e.content.code;s.trusted=true;o.update();return true}case"execute_result":case"display_data":case"stream":case"error":{c=this._parent.getCell(a);if(!c){return false}const e=Object.assign(Object.assign({},t.content),{output_type:l});c.model.outputs.add(e);o.update();return true}case"clear_output":{const e=t.content.wait;c=this._parent.getCell(a);if(c){c.model.outputs.clear(e)}return true}default:return false}}_newCell(e){const t=this.parent.createCodeCell();t.addClass(o);this._parent.addCell(t,e);return t}}class l{constructor(e){this._cursor=0;this._hasSession=false;this._history=[];this._placeholder="";this._setByHistory=false;this._isDisposed=false;this._editor=null;this._filtered=[];this.sessionContext=e.sessionContext;void this._handleKernel();this.sessionContext.kernelChanged.connect(this._handleKernel,this)}get editor(){return this._editor}set editor(e){if(this._editor===e){return}const t=this._editor;if(t){t.edgeRequested.disconnect(this.onEdgeRequest,this);t.model.value.changed.disconnect(this.onTextChange,this)}this._editor=e;if(e){e.edgeRequested.connect(this.onEdgeRequest,this);e.model.value.changed.connect(this.onTextChange,this)}}get placeholder(){return this._placeholder}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed=true;this._history.length=0;n.Signal.clearData(this)}back(e){if(!this._hasSession){this._hasSession=true;this._placeholder=e;this.setFilter(e);this._cursor=this._filtered.length-1}--this._cursor;this._cursor=Math.max(0,this._cursor);const t=this._filtered[this._cursor];return Promise.resolve(t)}forward(e){if(!this._hasSession){this._hasSession=true;this._placeholder=e;this.setFilter(e);this._cursor=this._filtered.length}++this._cursor;this._cursor=Math.min(this._filtered.length-1,this._cursor);const t=this._filtered[this._cursor];return Promise.resolve(t)}push(e){if(e&&e!==this._history[this._history.length-1]){this._history.push(e)}this.reset()}reset(){this._cursor=this._history.length;this._hasSession=false;this._placeholder=""}onHistory(e){this._history.length=0;let t="";let s="";if(e.content.status==="ok"){for(let n=0;n<e.content.history.length;n++){s=e.content.history[n][2];if(s!==t){this._history.push(t=s)}}}this._cursor=this._history.length}onTextChange(){if(this._setByHistory){this._setByHistory=false;return}this.reset()}onEdgeRequest(e,t){const s=e.model;const n=s.value.text;if(t==="top"||t==="topLine"){void this.back(n).then((t=>{if(this.isDisposed||!t){return}if(s.value.text===t){return}this._setByHistory=true;s.value.text=t;let n=0;n=t.indexOf("\n");if(n<0){n=t.length}e.setCursorPosition({line:0,column:n})}))}else{void this.forward(n).then((t=>{if(this.isDisposed){return}const n=t||this.placeholder;if(s.value.text===n){return}this._setByHistory=true;s.value.text=n;const o=e.getPositionAt(n.length);if(o){e.setCursorPosition(o)}}))}}async _handleKernel(){var e;const t=(e=this.sessionContext.session)===null||e===void 0?void 0:e.kernel;if(!t){this._history.length=0;return}return t.requestHistory(r.initialRequest).then((e=>{this.onHistory(e)}))}setFilter(e=""){this._filtered.length=0;let t="";let s="";for(let n=0;n<this._history.length;n++){s=this._history[n];if(s!==t&&e===s.slice(0,e.length)){this._filtered.push(t=s)}}this._filtered.push(e)}}var r;(function(e){e.initialRequest={output:false,raw:true,hist_access_type:"tail",n:500}})(r||(r={}));var a=s(26825);var c=s(83875);var h=s(72805);var d=s(1612);var u=s(92481);var p=s(9727);var _=s(61389);var C=s(6014);var m=s(20702);var f=s(62867);var g=s(43800);const y="jpKernelUser";const v="jpCodeRunner";const x="jp-CodeConsole";const w="jp-Console-cell";const D="jp-CodeConsole-banner";const b="jp-CodeConsole-promptCell";const F="jp-CodeConsole-content";const k="jp-CodeConsole-input";const P=250;const T="application/vnd.jupyter.cells";class S extends _.Widget{constructor(e){super();this._banner=null;this._executed=new n.Signal(this);this._mimetype="text/x-ipython";this._msgIds=new Map;this._msgIdCells=new Map;this._promptCellCreated=new n.Signal(this);this._dragData=null;this._drag=null;this._focusedCell=null;this.addClass(x);this.node.dataset[y]="true";this.node.dataset[v]="true";this.node.tabIndex=-1;const t=this.layout=new _.PanelLayout;this._cells=new m.ObservableList;this._content=new _.Panel;this._input=new _.Panel;this.contentFactory=e.contentFactory||S.defaultContentFactory;this.modelFactory=e.modelFactory||S.defaultModelFactory;this.rendermime=e.rendermime;this.sessionContext=e.sessionContext;this._mimeTypeService=e.mimeTypeService;this._content.addClass(F);this._input.addClass(k);t.addWidget(this._content);t.addWidget(this._input);this._history=new l({sessionContext:this.sessionContext});void this._onKernelChanged();this.sessionContext.kernelChanged.connect(this._onKernelChanged,this);this.sessionContext.statusChanged.connect(this._onKernelStatusChanged,this)}get executed(){return this._executed}get promptCellCreated(){return this._promptCellCreated}get cells(){return this._cells}get promptCell(){const e=this._input.layout;return e.widgets[0]||null}addCell(e,t){e.addClass(w);this._content.addWidget(e);this._cells.push(e);if(t){this._msgIds.set(t,e);this._msgIdCells.set(e,t)}e.disposed.connect(this._onCellDisposed,this);this.update()}addBanner(){if(this._banner){const e=this._banner;this._cells.push(this._banner);e.disposed.connect(this._onCellDisposed,this)}const e=this.modelFactory.createRawCell({});e.value.text="...";const t=(this._banner=new C.RawCell({model:e,contentFactory:this.contentFactory,placeholder:false})).initializeState();t.addClass(D);t.readOnly=true;this._content.addWidget(t)}clear(){const e=this._cells;while(e.length>0){e.get(0).dispose()}}createCodeCell(){const e=this.contentFactory;const t=this._createCodeCellOptions();const s=e.createCodeCell(t);s.readOnly=true;s.model.mimeType=this._mimetype;return s}dispose(){if(this.isDisposed){return}this._cells.clear();this._msgIdCells=null;this._msgIds=null;this._history.dispose();super.dispose()}async execute(e=false,t=P){var s,n;if(((n=(s=this.sessionContext.session)===null||s===void 0?void 0:s.kernel)===null||n===void 0?void 0:n.status)==="dead"){return}const o=this.promptCell;if(!o){throw new Error("Cannot execute without a prompt cell")}o.model.trusted=true;if(e){this.newPromptCell();await this._execute(o);return}const i=await this._shouldExecute(t);if(this.isDisposed){return}if(i){this.newPromptCell();this.promptCell.editor.focus();await this._execute(o)}else{o.editor.newIndentedLine()}}getCell(e){return this._msgIds.get(e)}inject(e,t={}){const s=this.createCodeCell();s.model.value.text=e;for(const n of Object.keys(t)){s.model.metadata.set(n,t[n])}this.addCell(s);return this._execute(s)}insertLinebreak(){const e=this.promptCell;if(!e){return}e.editor.newIndentedLine()}replaceSelection(e){var t,s;const n=this.promptCell;if(!n){return}(s=(t=n.editor).replaceSelection)===null||s===void 0?void 0:s.call(t,e)}serialize(){const e=[];(0,f.each)(this._cells,(t=>{const s=t.model;if((0,C.isCodeCellModel)(s)){e.push(s.toJSON())}}));if(this.promptCell){e.push(this.promptCell.model.toJSON())}return e}_evtMouseDown(e){const{button:t,shiftKey:s}=e;if(!(t===0||t===2)||s&&t===2){return}let n=e.target;const o=e=>e.classList.contains(w);let i=C.CellDragUtils.findCell(n,this._cells,o);if(i===-1){n=document.elementFromPoint(e.clientX,e.clientY);i=C.CellDragUtils.findCell(n,this._cells,o)}if(i===-1){return}const l=this._cells.get(i);const r=C.CellDragUtils.detectTargetArea(l,e.target);if(r==="prompt"){this._dragData={pressX:e.clientX,pressY:e.clientY,index:i};this._focusedCell=l;document.addEventListener("mouseup",this,true);document.addEventListener("mousemove",this,true);e.preventDefault()}}_evtMouseMove(e){const t=this._dragData;if(t&&C.CellDragUtils.shouldStartDrag(t.pressX,t.pressY,e.clientX,e.clientY)){void this._startDrag(t.index,e.clientX,e.clientY)}}_startDrag(e,t,s){const n=this._focusedCell.model;const o=[n.toJSON()];const i=C.CellDragUtils.createCellDragImage(this._focusedCell,o);this._drag=new g.Drag({mimeData:new p.MimeData,dragImage:i,proposedAction:"copy",supportedActions:"copy",source:this});this._drag.mimeData.setData(T,o);const l=n.value.text;this._drag.mimeData.setData("text/plain",l);this._focusedCell=null;document.removeEventListener("mousemove",this,true);document.removeEventListener("mouseup",this,true);return this._drag.start(t,s).then((()=>{if(this.isDisposed){return}this._drag=null;this._dragData=null}))}handleEvent(e){switch(e.type){case"keydown":this._evtKeyDown(e);break;case"mousedown":this._evtMouseDown(e);break;case"mousemove":this._evtMouseMove(e);break;case"mouseup":this._evtMouseUp(e);break;default:break}}onAfterAttach(e){const t=this.node;t.addEventListener("keydown",this,true);t.addEventListener("click",this);t.addEventListener("mousedown",this);if(!this.promptCell){this.newPromptCell()}else{this.promptCell.editor.focus();this.update()}}onBeforeDetach(e){const t=this.node;t.removeEventListener("keydown",this,true);t.removeEventListener("click",this)}onActivateRequest(e){const t=this.promptCell&&this.promptCell.editor;if(t){t.focus()}this.update()}newPromptCell(){let e=this.promptCell;const t=this._input;if(e){e.readOnly=true;e.removeClass(b);n.Signal.clearData(e.editor);const s=t.widgets[0];s.parent=null;this.addCell(e)}const s=this.contentFactory;const o=this._createCodeCellOptions();e=s.createCodeCell(o);e.model.mimeType=this._mimetype;e.addClass(b);this._input.addWidget(e);const i=e.editor;i.addKeydownHandler(this._onEditorKeydown);this._history.editor=i;this._promptCellCreated.emit(e)}onUpdateRequest(e){I.scrollToBottom(this._content.node)}_evtKeyDown(e){const t=this.promptCell&&this.promptCell.editor;if(!t){return}if(e.keyCode===13&&!t.hasFocus()){e.preventDefault();t.focus()}else if(e.keyCode===27&&t.hasFocus()){e.preventDefault();e.stopPropagation();this.node.focus()}}_evtMouseUp(e){if(this.promptCell&&this.promptCell.node.contains(e.target)){this.promptCell.editor.focus()}}_execute(e){const t=e.model.value.text;this._history.push(t);if(t==="clear"||t==="%clear"){this.clear();return Promise.resolve(void 0)}e.model.contentChanged.connect(this.update,this);const s=t=>{if(this.isDisposed){return}if(t&&t.content.status==="ok"){const s=t.content;if(s.payload&&s.payload.length){const t=s.payload.filter((e=>e.source==="set_next_input"))[0];if(t){const s=t.text;e.model.value.text=s}}}else if(t&&t.content.status==="error"){(0,f.each)(this._cells,(e=>{if(e.model.executionCount===null){e.setPrompt("")}}))}e.model.contentChanged.disconnect(this.update,this);this.update();this._executed.emit(new Date)};const n=()=>{if(this.isDisposed){return}e.model.contentChanged.disconnect(this.update,this);this.update()};return C.CodeCell.execute(e,this.sessionContext).then(s,n)}_handleInfo(e){if(e.status!=="ok"){this._banner.model.value.text="Error in getting kernel banner";return}this._banner.model.value.text=e.banner;const t=e.language_info;this._mimetype=this._mimeTypeService.getMimeTypeByLanguage(t);if(this.promptCell){this.promptCell.model.mimeType=this._mimetype}}_createCodeCellOptions(){const e=this.contentFactory;const t=this.modelFactory;const s=t.createCodeCell({});const n=this.rendermime;return{model:s,rendermime:n,contentFactory:e,placeholder:false}}_onCellDisposed(e,t){if(!this.isDisposed){this._cells.removeValue(e);const t=this._msgIdCells.get(e);if(t){this._msgIdCells.delete(e);this._msgIds.delete(t)}}}_shouldExecute(e){const t=this.promptCell;if(!t){return Promise.resolve(false)}const s=t.model;const n=s.value.text;return new Promise(((t,s)=>{var o;const i=setTimeout((()=>{t(true)}),e);const l=(o=this.sessionContext.session)===null||o===void 0?void 0:o.kernel;if(!l){t(false);return}l.requestIsComplete({code:n}).then((e=>{clearTimeout(i);if(this.isDisposed){t(false)}if(e.content.status!=="incomplete"){t(true);return}t(false)})).catch((()=>{t(true)}))}))}_onEditorKeydown(e,t){return t.keyCode===13}async _onKernelChanged(){var e;this.clear();if(this._banner){this._banner.dispose();this._banner=null}this.addBanner();if((e=this.sessionContext.session)===null||e===void 0?void 0:e.kernel){this._handleInfo(await this.sessionContext.session.kernel.info)}}async _onKernelStatusChanged(){var e;const t=(e=this.sessionContext.session)===null||e===void 0?void 0:e.kernel;if((t===null||t===void 0?void 0:t.status)==="restarting"){this.addBanner();this._handleInfo(await(t===null||t===void 0?void 0:t.info))}}}(function(e){class t extends C.Cell.ContentFactory{createCodeCell(e){if(!e.contentFactory){e.contentFactory=this}return new C.CodeCell(e).initializeState()}createRawCell(e){if(!e.contentFactory){e.contentFactory=this}return new C.RawCell(e).initializeState()}}e.ContentFactory=t;e.defaultContentFactory=new t;class s{constructor(e={}){this.codeCellContentFactory=e.codeCellContentFactory||C.CodeCellModel.defaultContentFactory}createCodeCell(e){if(!e.contentFactory){e.contentFactory=this.codeCellContentFactory}return new C.CodeCellModel(e)}createRawCell(e){return new C.RawCellModel(e)}}e.ModelFactory=s;e.defaultModelFactory=new s({})})(S||(S={}));var I;(function(e){function t(e){e.scrollTop=e.scrollHeight-e.clientHeight}e.scrollToBottom=t})(I||(I={}));const M="jp-ConsolePanel";class E extends a.MainAreaWidget{constructor(e){super({content:new _.Panel});this._executed=null;this._connected=null;this.addClass(M);let{rendermime:t,mimeTypeService:s,path:n,basePath:o,name:i,manager:l,modelFactory:r,sessionContext:C,translator:m}=e;this.translator=m||d.nullTranslator;const f=this.translator.load("jupyterlab");const g=this.contentFactory=e.contentFactory||E.defaultContentFactory;const y=R.count++;if(!n){n=c.URLExt.join(o||"",`console-${y}-${p.UUID.uuid4()}`)}C=this._sessionContext=C||new a.SessionContext({sessionManager:l.sessions,specsManager:l.kernelspecs,path:n,name:i||f.__("Console %1",y),type:"console",kernelPreference:e.kernelPreference,setBusy:e.setBusy});const v=new h.RenderMimeRegistry.UrlResolver({session:C,contents:l.contents});t=t.clone({resolver:v});this.console=g.createConsole({rendermime:t,sessionContext:C,mimeTypeService:s,contentFactory:g,modelFactory:r});this.content.addWidget(this.console);void C.initialize().then((async e=>{if(e){await a.sessionContextDialogs.selectKernel(C)}this._connected=new Date;this._updateTitlePanel()}));this.console.executed.connect(this._onExecuted,this);this._updateTitlePanel();C.kernelChanged.connect(this._updateTitlePanel,this);C.propertyChanged.connect(this._updateTitlePanel,this);this.title.icon=u.consoleIcon;this.title.closable=true;this.id=`console-${y}`}get sessionContext(){return this._sessionContext}dispose(){this.sessionContext.dispose();this.console.dispose();super.dispose()}onActivateRequest(e){const t=this.console.promptCell;if(t){t.editor.focus()}}onCloseRequest(e){super.onCloseRequest(e);this.dispose()}_onExecuted(e,t){this._executed=t;this._updateTitlePanel()}_updateTitlePanel(){R.updateTitle(this,this._connected,this._executed,this.translator)}}(function(e){class t extends S.ContentFactory{createConsole(e){return new S(e)}}e.ContentFactory=t;e.defaultContentFactory=new t;e.IContentFactory=new p.Token("@jupyterlab/console:IContentFactory")})(E||(E={}));var R;(function(e){e.count=1;function t(e,t,s,n){n=n||d.nullTranslator;const o=n.load("jupyterlab");const i=e.console.sessionContext.session;if(i){let n=o.__("Name: %1\n",i.name)+o.__("Directory: %1\n",c.PathExt.dirname(i.path))+o.__("Kernel: %1",e.console.sessionContext.kernelDisplayName);if(t){n+=o.__("\nConnected: %1",c.Time.format(t.toISOString()))}if(s){n+=o.__("\nLast Execution: %1")}e.title.label=i.name;e.title.caption=n}else{e.title.label=o.__("Console");e.title.caption=""}}e.updateTitle=t})(R||(R={}));const j=new p.Token("@jupyterlab/console:IConsoleTracker")}}]);